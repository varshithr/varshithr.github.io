<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi Region Api Answers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F4F8;
            color: #1E293B;
        }
        .gradient-text {
            background: linear-gradient(90deg, #58508d, #bc5090);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .content {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05), 0 4px 6px -4px rgb(0 0 0 / 0.05);
            margin-top: 2rem;
        }
        .content h1 {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 1rem;
            color: #1E293B;
        }
        .content h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #1E293B;
            border-bottom: 2px solid #E5E7EB;
            padding-bottom: 0.5rem;
        }
        .content h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #1E293B;
        }
        .content h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #1E293B;
        }
        .content p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }
        .content ul, .content ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }
        .content li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }
        .content code {
            background-color: #F3F4F6;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .content pre {
            background-color: #1E293B;
            color: #F0F4F8;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        .content pre code {
            background-color: transparent;
            padding: 0;
            color: inherit;
        }
        .content blockquote {
            border-left: 4px solid #58508d;
            padding-left: 1rem;
            margin-left: 0;
            margin-bottom: 1rem;
            color: #4B5563;
            font-style: italic;
        }
        .content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }
        .content th {
            background-color: #F3F4F6;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            border: 1px solid #E5E7EB;
        }
        .content td {
            padding: 0.75rem;
            border: 1px solid #E5E7EB;
        }
        .content tr:nth-child(even) {
            background-color: #F9FAFB;
        }
        .content a {
            color: #58508d;
            text-decoration: underline;
        }
        .content a:hover {
            color: #bc5090;
        }
        .content hr {
            border: none;
            border-top: 2px solid #E5E7EB;
            margin: 2rem 0;
        }
        .mermaid {
            margin: 2rem 0;
            text-align: center;
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .sidebar {
            position: fixed;
            top: 80px;
            left: 0;
            height: calc(100vh - 80px);
            width: 280px;
            background-color: white;
            border-right: 1px solid #E5E7EB;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 40;
            box-shadow: 2px 0 4px rgba(0, 0, 0, 0.05);
        }
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        .sidebar-toggle {
            position: fixed;
            top: 90px;
            left: 20px;
            z-index: 50;
            background-color: white;
            border: 1px solid #E5E7EB;
            border-radius: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: none;
        }
        .sidebar-toggle:hover {
            background-color: #F3F4F6;
        }
        .sidebar-content {
            padding: 1.5rem;
        }
        .sidebar-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #E5E7EB;
        }
        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .sidebar-nav li {
            margin-bottom: 0.5rem;
        }
        .sidebar-nav a {
            display: block;
            padding: 0.5rem 0.75rem;
            color: #4B5563;
            text-decoration: none;
            border-radius: 0.375rem;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        .sidebar-nav a:hover {
            background-color: #F3F4F6;
            color: #58508d;
        }
        .sidebar-nav a.active {
            background-color: #EEF2FF;
            color: #58508d;
            font-weight: 600;
        }
        .sidebar-nav .level-1 {
            padding-left: 0.75rem;
            font-weight: 600;
            color: #1E293B;
        }
        .sidebar-nav .level-2 {
            padding-left: 1.5rem;
            color: #4B5563;
        }
        .sidebar-nav .level-3 {
            padding-left: 2.25rem;
            color: #6B7280;
            font-size: 0.8125rem;
        }
        .sidebar-nav .level-4 {
            padding-left: 3rem;
            color: #9CA3AF;
            font-size: 0.75rem;
        }
        .main-content {
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }
        .main-content.no-sidebar {
            margin-left: 0;
        }
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.expanded {
                transform: translateX(0);
            }
            .sidebar-toggle {
                display: block;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body class="antialiased">
    <header class="bg-white sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
            <div class="text-xl sm:text-2xl font-bold text-gray-800">
                <a href="../../../index.html" class="flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                    <span class="gradient-text">Data Engineering Concepts</span>
                </a>
            </div>
            <ul class="flex space-x-4 sm:space-x-6 text-gray-600 font-medium text-sm sm:text-base">
                <li><a href="../../../case_studies.html" class="hover:text-[#bc5090] font-semibold">Case Studies</a></li>
                <li><a href="../../../aboutme.html" class="hover:text-[#bc5090] font-semibold">About Me</a></li>
            </ul>
        </nav>
    </header>
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
        <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-title">Table of Contents</div>
            <ul class="sidebar-nav">
                <li><a href="#answer-key-multi-region-api-on-gcp" class="level-1">Answer Key: Multi-Region API on GCP</a></li>
                <li><a href="#exercise-1-design-improvements" class="level-2">Exercise 1: Design Improvements</a></li>
                <li><a href="#answer" class="level-3">Answer</a></li>
                <li><a href="#potential-improvements" class="level-3">Potential Improvements</a></li>
                <li><a href="#top-3-improvements" class="level-3">Top 3 Improvements</a></li>
                <li><a href="#answer_1" class="level-3">Answer</a></li>
                <li><a href="#exercise-2-handle-new-requirement" class="level-2">Exercise 2: Handle New Requirement</a></li>
                <li><a href="#answer_2" class="level-3">Answer</a></li>
                <li><a href="#architecture-changes" class="level-3">Architecture Changes</a></li>
                <li><a href="#updated-architecture" class="level-3">Updated Architecture</a></li>
                <li><a href="#implementation-details" class="level-3">Implementation Details</a></li>
                <li><a href="#answer_3" class="level-3">Answer</a></li>
                <li><a href="#exercise-3-cost-optimization" class="level-2">Exercise 3: Cost Optimization</a></li>
                <li><a href="#answer_4" class="level-3">Answer</a></li>
                <li><a href="#cost-optimization-strategies" class="level-3">Cost Optimization Strategies</a></li>
                <li><a href="#combined-savings" class="level-3">Combined Savings</a></li>
                <li><a href="#answer_5" class="level-3">Answer</a></li>
                <li><a href="#exercise-4-disaster-recovery" class="level-2">Exercise 4: Disaster Recovery</a></li>
                <li><a href="#answer_6" class="level-3">Answer</a></li>
                <li><a href="#disaster-scenarios" class="level-3">Disaster Scenarios</a></li>
                <li><a href="#disaster-recovery-plan" class="level-3">Disaster Recovery Plan</a></li>
                <li><a href="#rto-and-rpo" class="level-3">RTO and RPO</a></li>
                <li><a href="#answer_7" class="level-3">Answer</a></li>
            </ul>
        </div>
    </aside>
    <main class="main-content container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="content">
<h1 id="answer-key-multi-region-api-on-gcp">Answer Key: Multi-Region API on GCP</h1>
<p><a href="../../06-case-studies/multi-region-api.html">Back to Exercises</a></p>
<hr />
<h2 id="exercise-1-design-improvements">Exercise 1: Design Improvements</h2>
<p><strong>Question</strong>: How would you improve this design? What tradeoffs?</p>
<h3 id="answer">Answer</h3>
<p><strong>Current Design</strong>: Multi-region API with Global Load Balancer, GKE, Spanner, Redis cache</p>
<h3 id="potential-improvements">Potential Improvements</h3>
<p><strong>1. Add CDN for Static Content</strong></p>
<p><strong>Improvement</strong>: Use Cloud CDN for static assets (images, CSS, JS)</p>
<p><strong>Benefits</strong>:
- Lower latency for static content
- Reduced origin load
- Lower bandwidth costs</p>
<p><strong>Tradeoffs</strong>:
- Additional complexity
- Cache invalidation needed
- Additional cost</p>
<p><strong>2. Add Read Replicas</strong></p>
<p><strong>Improvement</strong>: Use Spanner read replicas for read-heavy workloads</p>
<p><strong>Benefits</strong>:
- Lower read latency (closer to users)
- Reduced load on primary database
- Better read scalability</p>
<p><strong>Tradeoffs</strong>:
- Eventual consistency (reads may be stale)
- Additional cost
- More complex architecture</p>
<p><strong>3. Add Message Queue</strong></p>
<p><strong>Improvement</strong>: Use Pub/Sub for async processing (already mentioned, but expand)</p>
<p><strong>Benefits</strong>:
- Decouple components
- Better resilience
- Scalable processing</p>
<p><strong>Tradeoffs</strong>:
- Eventual consistency
- More complex error handling
- Additional cost</p>
<p><strong>4. Add Circuit Breakers</strong></p>
<p><strong>Improvement</strong>: Add circuit breakers for downstream services</p>
<p><strong>Benefits</strong>:
- Prevent cascading failures
- Fail fast
- Better resilience</p>
<p><strong>Tradeoffs</strong>:
- Additional complexity
- Need to handle circuit states
- May delay recovery</p>
<p><strong>5. Add Rate Limiting</strong></p>
<p><strong>Improvement</strong>: Add rate limiting at load balancer or API gateway</p>
<p><strong>Benefits</strong>:
- Prevent abuse
- Fair resource usage
- DDoS protection</p>
<p><strong>Tradeoffs</strong>:
- May reject legitimate requests
- Additional complexity
- Need to tune limits</p>
<p><strong>6. Add Caching Layer</strong></p>
<p><strong>Improvement</strong>: Expand caching strategy (already has Redis, but optimize)</p>
<p><strong>Benefits</strong>:
- Lower latency
- Reduced database load
- Better scalability</p>
<p><strong>Tradeoffs</strong>:
- Cache invalidation complexity
- Memory costs
- Stale data risk</p>
<p><strong>7. Add Monitoring and Observability</strong></p>
<p><strong>Improvement</strong>: Enhanced monitoring (already mentioned, but expand)</p>
<p><strong>Benefits</strong>:
- Better visibility
- Faster debugging
- Proactive issue detection</p>
<p><strong>Tradeoffs</strong>:
- Additional cost
- More data to manage
- Alert fatigue risk</p>
<h3 id="top-3-improvements">Top 3 Improvements</h3>
<p><strong>1. Add CDN</strong> (High Impact, Low Complexity)
- Significant latency improvement for static content
- Relatively simple to implement
- Clear cost/benefit</p>
<p><strong>2. Add Read Replicas</strong> (High Impact, Medium Complexity)
- Significant read performance improvement
- Moderate complexity
- Good for read-heavy workloads</p>
<p><strong>3. Add Circuit Breakers</strong> (Medium Impact, Low Complexity)
- Better resilience
- Relatively simple to implement
- Prevents cascading failures</p>
<h3 id="answer_1">Answer</h3>
<p><strong>Design Improvements</strong>:</p>
<p><strong>1. Add CDN</strong>: Lower latency for static content, reduced origin load
<strong>2. Add Read Replicas</strong>: Better read performance, reduced database load
<strong>3. Add Circuit Breakers</strong>: Better resilience, prevent cascading failures
<strong>4. Enhance Rate Limiting</strong>: Better abuse prevention, DDoS protection
<strong>5. Optimize Caching</strong>: Better cache hit rates, reduced latency</p>
<p><strong>Top 3</strong>:
1. <strong>CDN</strong> (high impact, low complexity)
2. <strong>Read Replicas</strong> (high impact, medium complexity)
3. <strong>Circuit Breakers</strong> (medium impact, low complexity)</p>
<p><strong>Tradeoffs</strong>:
- <strong>CDN</strong>: Additional complexity, cache invalidation
- <strong>Read Replicas</strong>: Eventual consistency, additional cost
- <strong>Circuit Breakers</strong>: Additional complexity, circuit state management</p>
<hr />
<h2 id="exercise-2-handle-new-requirement">Exercise 2: Handle New Requirement</h2>
<p><strong>Question</strong>: Add support for real-time notifications. How does this change the architecture?</p>
<h3 id="answer_2">Answer</h3>
<p><strong>Requirement</strong>: Real-time notifications to users</p>
<h3 id="architecture-changes">Architecture Changes</h3>
<p><strong>1. Add WebSocket Support</strong></p>
<p><strong>New Component</strong>: WebSocket server for real-time connections</p>
<p><strong>Options</strong>:
- <strong>Option A</strong>: Separate WebSocket service
- <strong>Option B</strong>: Add WebSocket support to existing API</p>
<p><strong>Recommendation</strong>: Separate WebSocket service (better separation of concerns)</p>
<p><strong>2. Add Message Queue</strong></p>
<p><strong>New Component</strong>: Pub/Sub for notification delivery</p>
<p><strong>Flow</strong>:
1. Event occurs → Publish to Pub/Sub
2. WebSocket service subscribes to Pub/Sub
3. WebSocket service sends to connected clients</p>
<p><strong>3. Add Connection Management</strong></p>
<p><strong>New Component</strong>: Connection manager for WebSocket connections</p>
<p><strong>Requirements</strong>:
- Track connected users
- Handle reconnections
- Manage connection lifecycle</p>
<p><strong>4. Add Notification Service</strong></p>
<p><strong>New Component</strong>: Notification service for sending notifications</p>
<p><strong>Responsibilities</strong>:
- Receive events from Pub/Sub
- Look up connected users
- Send notifications via WebSocket</p>
<h3 id="updated-architecture">Updated Architecture</h3>
<div class="mermaid">
graph TB
API[API Servers] --> PubSub[Pub/Sub<br/>Events]
PubSub --> NotifService[Notification Service]
NotifService --> WS[WebSocket Service]
WS --> Users[Connected Users]
Users --> WS
WS --> ConnMgr[Connection Manager]
ConnMgr --> Redis2[Redis<br/>Connection State]
style PubSub fill:#99ff99
style WS fill:#ffcc99
style NotifService fill:#99ccff
</div>
<h3 id="implementation-details">Implementation Details</h3>
<p><strong>1. WebSocket Service</strong></p>
<p><strong>Deployment</strong>: Separate GKE service</p>
<p><strong>Scaling</strong>: Horizontal scaling based on connections</p>
<p><strong>Load Balancing</strong>: Use Network Load Balancer (WebSocket support)</p>
<p><strong>2. Connection Manager</strong></p>
<p><strong>Storage</strong>: Redis for connection state</p>
<p><strong>Data Structure</strong>:
- <code>user:{user_id}</code> → <code>{connection_id, region, timestamp}</code>
- <code>connection:{connection_id}</code> → <code>{user_id, region, timestamp}</code></p>
<p><strong>3. Notification Flow</strong></p>
<p><strong>Process</strong>:
1. Event occurs in API
2. API publishes to Pub/Sub topic <code>user-notifications</code>
3. Notification service subscribes to topic
4. Notification service looks up user connections in Redis
5. Notification service sends to WebSocket service
6. WebSocket service delivers to user</p>
<p><strong>4. Multi-Region Considerations</strong></p>
<p><strong>Challenge</strong>: User connected in one region, event in another</p>
<p><strong>Solution</strong>:
- <strong>Option A</strong>: Global Pub/Sub, regional WebSocket services
- <strong>Option B</strong>: Regional Pub/Sub, cross-region notification routing</p>
<p><strong>Recommendation</strong>: Global Pub/Sub, regional WebSocket services</p>
<h3 id="answer_3">Answer</h3>
<p><strong>Architecture Changes</strong>:</p>
<p><strong>New Components</strong>:
1. <strong>WebSocket Service</strong>: Handles real-time connections
2. <strong>Notification Service</strong>: Processes notifications from Pub/Sub
3. <strong>Connection Manager</strong>: Tracks user connections (Redis)
4. <strong>Pub/Sub Topic</strong>: <code>user-notifications</code> for event delivery</p>
<p><strong>Flow</strong>:
1. Event → Pub/Sub → Notification Service → WebSocket Service → User
2. Connection state stored in Redis
3. Multi-region: Global Pub/Sub, regional WebSocket services</p>
<p><strong>Changes to Existing</strong>:
- <strong>API</strong>: Publish events to Pub/Sub
- <strong>Load Balancer</strong>: Add WebSocket support (Network LB)
- <strong>Redis</strong>: Store connection state</p>
<p><strong>Key Considerations</strong>:
- <strong>Scaling</strong>: WebSocket service scales with connections
- <strong>Multi-region</strong>: Handle cross-region notifications
- <strong>Reconnection</strong>: Handle connection failures gracefully
- <strong>Delivery guarantees</strong>: At-least-once delivery</p>
<hr />
<h2 id="exercise-3-cost-optimization">Exercise 3: Cost Optimization</h2>
<p><strong>Question</strong>: How would you reduce costs by 30%? What tradeoffs?</p>
<h3 id="answer_4">Answer</h3>
<p><strong>Current Cost</strong>: ~$18,000/month
<strong>Target</strong>: ~$12,600/month (30% reduction)</p>
<h3 id="cost-optimization-strategies">Cost Optimization Strategies</h3>
<p><strong>1. Right-Size Instances</strong> (Savings: ~20%)</p>
<p><strong>Current</strong>: May be over-provisioned</p>
<p><strong>Optimization</strong>:
- Analyze actual resource usage
- Use smaller instance types where possible
- Use committed use discounts (1-year or 3-year)</p>
<p><strong>Savings</strong>: ~$3,600/month</p>
<p><strong>Tradeoffs</strong>:
- Less headroom for spikes
- Need to monitor capacity closely
- May need to scale more frequently</p>
<p><strong>2. Optimize Spanner</strong> (Savings: ~15%)</p>
<p><strong>Current</strong>: Multi-region Spanner (expensive)</p>
<p><strong>Optimization</strong>:
- Use regional Spanner (if multi-region not needed)
- Optimize queries (reduce reads)
- Use read replicas instead of multi-region
- Archive old data to cheaper storage</p>
<p><strong>Savings</strong>: ~$1,500/month</p>
<p><strong>Tradeoffs</strong>:
- Regional Spanner: Less resilience
- Read replicas: Eventual consistency
- Archive: Slower access to old data</p>
<p><strong>3. Optimize Caching</strong> (Savings: ~10%)</p>
<p><strong>Current</strong>: Redis cache per region</p>
<p><strong>Optimization</strong>:
- Increase cache hit rate (reduce cache misses)
- Use smaller cache instances
- Use Cloud Memorystore standard tier (not premium)</p>
<p><strong>Savings</strong>: ~$200/month</p>
<p><strong>Tradeoffs</strong>:
- Lower cache hit rate: More database load
- Smaller cache: More evictions
- Standard tier: Lower performance</p>
<p><strong>4. Optimize Load Balancer</strong> (Savings: ~5%)</p>
<p><strong>Current</strong>: Global HTTP(S) Load Balancer</p>
<p><strong>Optimization</strong>:
- Use regional load balancer (if global not needed)
- Optimize SSL certificate management
- Reduce unnecessary routing rules</p>
<p><strong>Savings</strong>: ~$100/month</p>
<p><strong>Tradeoffs</strong>:
- Regional LB: Less global distribution
- May increase latency for some users</p>
<p><strong>5. Optimize GKE</strong> (Savings: ~10%)</p>
<p><strong>Current</strong>: GKE with auto-scaling</p>
<p><strong>Optimization</strong>:
- Use preemptible instances (for non-critical workloads)
- Optimize pod resource requests
- Use node auto-provisioning
- Right-size node pools</p>
<p><strong>Savings</strong>: ~$500/month</p>
<p><strong>Tradeoffs</strong>:
- Preemptible: Less reliable (may be terminated)
- Need to handle interruptions gracefully</p>
<p><strong>6. Optimize Storage</strong> (Savings: ~5%)</p>
<p><strong>Current</strong>: Standard storage classes</p>
<p><strong>Optimization</strong>:
- Use Nearline/Coldline for less accessed data
- Lifecycle policies to move old data
- Compress data</p>
<p><strong>Savings</strong>: ~$100/month</p>
<p><strong>Tradeoffs</strong>:
- Nearline/Coldline: Higher access costs
- Slower access to archived data</p>
<h3 id="combined-savings">Combined Savings</h3>
<p><strong>Total</strong>: ~$6,000/month (33% reduction)</p>
<p><strong>Breakdown</strong>:
- Right-sizing: $3,600
- Spanner optimization: $1,500
- GKE optimization: $500
- Caching optimization: $200
- Load balancer: $100
- Storage: $100</p>
<h3 id="answer_5">Answer</h3>
<p><strong>Cost Optimization Strategies</strong> (30% reduction):</p>
<p><strong>1. Right-Size Instances</strong> (20% savings):
- Analyze usage, use smaller instances, committed use discounts
- Tradeoff: Less headroom, need closer monitoring</p>
<p><strong>2. Optimize Spanner</strong> (15% savings):
- Use regional Spanner, optimize queries, archive old data
- Tradeoff: Less resilience, eventual consistency</p>
<p><strong>3. Optimize GKE</strong> (10% savings):
- Use preemptible instances, optimize resource requests
- Tradeoff: Less reliable, need interruption handling</p>
<p><strong>4. Optimize Caching</strong> (10% savings):
- Increase hit rate, use smaller instances
- Tradeoff: More database load</p>
<p><strong>5. Optimize Load Balancer</strong> (5% savings):
- Use regional LB if global not needed
- Tradeoff: Less global distribution</p>
<p><strong>Total Savings</strong>: ~33% ($6,000/month)</p>
<p><strong>Key Tradeoffs</strong>:
- <strong>Reliability</strong>: Some optimizations reduce resilience
- <strong>Performance</strong>: Some optimizations reduce performance
- <strong>Complexity</strong>: Some optimizations add complexity</p>
<p><strong>Recommendation</strong>: Focus on right-sizing and Spanner optimization first (biggest savings, manageable tradeoffs).</p>
<hr />
<h2 id="exercise-4-disaster-recovery">Exercise 4: Disaster Recovery</h2>
<p><strong>Question</strong>: Design a disaster recovery plan. What's the RTO? RPO?</p>
<h3 id="answer_6">Answer</h3>
<p><strong>Goal</strong>: Recover from disasters with minimal data loss and downtime</p>
<h3 id="disaster-scenarios">Disaster Scenarios</h3>
<p><strong>1. Single Region Failure</strong></p>
<p><strong>Scenario</strong>: One region (e.g., us-central1) completely fails</p>
<p><strong>Impact</strong>: 33% of users affected</p>
<p><strong>Recovery</strong>: 
- Load balancer routes to other regions
- Auto-scaling scales up other regions
- <strong>RTO</strong>: &lt; 5 minutes (automatic)
- <strong>RPO</strong>: 0 (no data loss, Spanner multi-region)</p>
<p><strong>2. Database Failure</strong></p>
<p><strong>Scenario</strong>: Spanner becomes unavailable</p>
<p><strong>Impact</strong>: All regions, all users</p>
<p><strong>Recovery</strong>:
- Spanner has automatic failover (multi-region)
- Failover takes ~30 seconds
- <strong>RTO</strong>: &lt; 1 minute (automatic)
- <strong>RPO</strong>: 0 (no data loss, synchronous replication)</p>
<p><strong>3. Complete GCP Failure</strong></p>
<p><strong>Scenario</strong>: Entire GCP region fails (unlikely but possible)</p>
<p><strong>Impact</strong>: All services in region</p>
<p><strong>Recovery</strong>:
- Failover to other regions
- Restore from backups if needed
- <strong>RTO</strong>: &lt; 15 minutes (manual intervention)
- <strong>RPO</strong>: &lt; 5 minutes (depends on backup frequency)</p>
<p><strong>4. Data Corruption</strong></p>
<p><strong>Scenario</strong>: Data corrupted (bug, malicious attack)</p>
<p><strong>Impact</strong>: Data integrity compromised</p>
<p><strong>Recovery</strong>:
- Restore from backups
- Point-in-time recovery
- <strong>RTO</strong>: &lt; 1 hour (restore time)
- <strong>RPO</strong>: &lt; 15 minutes (backup frequency)</p>
<h3 id="disaster-recovery-plan">Disaster Recovery Plan</h3>
<p><strong>1. Backup Strategy</strong></p>
<p><strong>Spanner Backups</strong>:
- <strong>Frequency</strong>: Every 6 hours
- <strong>Retention</strong>: 30 days
- <strong>Location</strong>: Multi-region (backup in different region)
- <strong>Type</strong>: Point-in-time recovery</p>
<p><strong>Application Backups</strong>:
- <strong>Configuration</strong>: Version controlled (Git)
- <strong>Secrets</strong>: Stored in Secret Manager
- <strong>Infrastructure</strong>: Infrastructure as Code (Terraform)</p>
<p><strong>2. Failover Procedures</strong></p>
<p><strong>Automatic Failover</strong>:
- <strong>Load Balancer</strong>: Automatic (health checks)
- <strong>Spanner</strong>: Automatic (multi-region)
- <strong>GKE</strong>: Automatic (multi-region deployment)</p>
<p><strong>Manual Failover</strong>:
- <strong>Complete region failure</strong>: Manual DNS update, scale other regions
- <strong>Data corruption</strong>: Manual restore from backups</p>
<p><strong>3. Recovery Procedures</strong></p>
<p><strong>Single Region Failure</strong>:
1. Load balancer automatically routes away
2. Scale up other regions
3. Monitor recovery
4. Investigate root cause</p>
<p><strong>Database Failure</strong>:
1. Spanner automatically fails over
2. Verify data consistency
3. Monitor performance
4. Investigate root cause</p>
<p><strong>Complete Failure</strong>:
1. Activate disaster recovery runbook
2. Failover DNS to backup region
3. Scale up backup region
4. Restore from backups if needed
5. Verify functionality
6. Postmortem</p>
<p><strong>4. Testing</strong></p>
<p><strong>Disaster Recovery Testing</strong>:
- <strong>Frequency</strong>: Quarterly
- <strong>Scenarios</strong>: Single region failure, database failure
- <strong>Process</strong>: Simulate failures, verify recovery
- <strong>Documentation</strong>: Update runbooks based on tests</p>
<h3 id="rto-and-rpo">RTO and RPO</h3>
<p><strong>RTO (Recovery Time Objective)</strong>:</p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>RTO</th>
<th>Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Single region failure</td>
<td>&lt; 5 minutes</td>
<td>Automatic (load balancer)</td>
</tr>
<tr>
<td>Database failure</td>
<td>&lt; 1 minute</td>
<td>Automatic (Spanner failover)</td>
</tr>
<tr>
<td>Complete failure</td>
<td>&lt; 15 minutes</td>
<td>Manual (DNS, scaling)</td>
</tr>
<tr>
<td>Data corruption</td>
<td>&lt; 1 hour</td>
<td>Manual (restore from backup)</td>
</tr>
</tbody>
</table>
<p><strong>RPO (Recovery Point Objective)</strong>:</p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>RPO</th>
<th>Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Single region failure</td>
<td>0</td>
<td>Multi-region Spanner</td>
</tr>
<tr>
<td>Database failure</td>
<td>0</td>
<td>Synchronous replication</td>
</tr>
<tr>
<td>Complete failure</td>
<td>&lt; 5 minutes</td>
<td>Backup frequency</td>
</tr>
<tr>
<td>Data corruption</td>
<td>&lt; 15 minutes</td>
<td>Point-in-time recovery</td>
</tr>
</tbody>
</table>
<h3 id="answer_7">Answer</h3>
<p><strong>Disaster Recovery Plan</strong>:</p>
<p><strong>Backup Strategy</strong>:
- Spanner: Every 6 hours, 30-day retention, multi-region
- Application: Version controlled, Infrastructure as Code</p>
<p><strong>Failover Procedures</strong>:
- <strong>Automatic</strong>: Load balancer, Spanner, GKE
- <strong>Manual</strong>: Complete region failure, data corruption</p>
<p><strong>Recovery Procedures</strong>:
- Single region: Automatic failover, scale other regions
- Database: Automatic Spanner failover
- Complete failure: Manual DNS update, restore from backups</p>
<p><strong>RTO (Recovery Time Objective)</strong>:
- Single region: &lt; 5 minutes (automatic)
- Database: &lt; 1 minute (automatic)
- Complete failure: &lt; 15 minutes (manual)
- Data corruption: &lt; 1 hour (manual restore)</p>
<p><strong>RPO (Recovery Point Objective)</strong>:
- Single region: 0 (multi-region Spanner)
- Database: 0 (synchronous replication)
- Complete failure: &lt; 5 minutes (backup frequency)
- Data corruption: &lt; 15 minutes (point-in-time recovery)</p>
<p><strong>Testing</strong>: Quarterly disaster recovery tests</p>
<p><strong>Key Principles</strong>:
- <strong>Automate where possible</strong>: Automatic failover for common scenarios
- <strong>Test regularly</strong>: Quarterly DR tests
- <strong>Document procedures</strong>: Clear runbooks for manual procedures
- <strong>Monitor recovery</strong>: Track RTO and RPO metrics</p>
        </div>
    </main>
    <footer class="bg-gray-800 text-white text-center p-6 mt-16">
        <p>&copy; 2025 Data Engineering Guides. An illustrative web application.</p>
    </footer>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
        
        // Sidebar toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const mainContent = document.querySelector('.main-content');
            
            // Toggle sidebar
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('expanded');
                });
            }
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 1024) {
                    if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
                        sidebar.classList.remove('expanded');
                    }
                }
            });
            
            // Update active link on scroll
            const headings = document.querySelectorAll('.content h1, .content h2, .content h3, .content h4');
            const sidebarLinks = document.querySelectorAll('.sidebar-nav a');
            
            function updateActiveLink() {
                let current = '';
                headings.forEach(heading => {
                    const rect = heading.getBoundingClientRect();
                    if (rect.top <= 100) {
                        current = heading.id;
                    }
                });
                
                sidebarLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === '#' + current) {
                        link.classList.add('active');
                    }
                });
            }
            
            window.addEventListener('scroll', updateActiveLink);
            updateActiveLink();
            
            // Smooth scroll for sidebar links
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    if (href.startsWith('#')) {
                        e.preventDefault();
                        const target = document.querySelector(href);
                        if (target) {
                            const headerOffset = 80;
                            const elementPosition = target.getBoundingClientRect().top;
                            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                            
                            window.scrollTo({
                                top: offsetPosition,
                                behavior: 'smooth'
                            });
                            
                            // Close sidebar on mobile after click
                            if (window.innerWidth <= 1024) {
                                sidebar.classList.remove('expanded');
                            }
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
