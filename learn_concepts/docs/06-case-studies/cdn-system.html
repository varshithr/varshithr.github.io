<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cdn System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="../../assets/styles.css">
</head>
<body class="antialiased">
    <header class="bg-white sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
            <div class="text-xl sm:text-2xl font-bold text-gray-800">
                <a href="../../../index.html" class="flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                    <span class="gradient-text">Data Engineering Concepts</span>
                </a>
            </div>
            <ul class="flex space-x-4 sm:space-x-6 text-gray-600 font-medium text-sm sm:text-base">
                <li><a href="../../../case_studies.html" class="hover:text-[#bc5090] font-semibold">Case Studies</a></li>
                <li><a href="../../../aboutme.html" class="hover:text-[#bc5090] font-semibold">About Me</a></li>
            </ul>
        </nav>
    </header>
        <button class="sidebar-toggle mobile" id="sidebarToggleMobile" aria-label="Toggle sidebar">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
    <button class="sidebar-toggle desktop" id="sidebarToggleDesktop" aria-label="Toggle sidebar">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">Table of Contents</div>
            <button class="sidebar-close" id="sidebarClose" aria-label="Close sidebar">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div class="sidebar-content">
            <ul class="sidebar-nav">
                <li><a href="#global-content-delivery-system" class="level-1">Global Content Delivery System</a></li>
                <li><a href="#system-overview" class="level-2">System Overview</a></li>
                <li><a href="#requirements" class="level-3">Requirements</a></li>
                <li><a href="#architecture" class="level-2">Architecture</a></li>
                <li><a href="#high-level-architecture" class="level-3">High-Level Architecture</a></li>
                <li><a href="#component-details" class="level-3">Component Details</a></li>
                <li><a href="#1-cloud-cdn" class="level-4">1. Cloud CDN</a></li>
                <li><a href="#2-global-load-balancer" class="level-4">2. Global Load Balancer</a></li>
                <li><a href="#3-origin-servers" class="level-4">3. Origin Servers</a></li>
                <li><a href="#4-cloud-storage" class="level-4">4. Cloud Storage</a></li>
                <li><a href="#5-api-server" class="level-4">5. API Server</a></li>
                <li><a href="#data-flow" class="level-2">Data Flow</a></li>
                <li><a href="#static-content-flow" class="level-3">Static Content Flow</a></li>
                <li><a href="#dynamic-content-flow" class="level-3">Dynamic Content Flow</a></li>
                <li><a href="#cache-invalidation-flow" class="level-3">Cache Invalidation Flow</a></li>
                <li><a href="#slis-slos-error-budgets" class="level-2">SLIs, SLOs &amp; Error Budgets</a></li>
                <li><a href="#slis-service-level-indicators" class="level-3">SLIs (Service Level Indicators)</a></li>
                <li><a href="#1-latency-sli" class="level-4">1. Latency SLI</a></li>
                <li><a href="#2-cache-hit-rate-sli" class="level-4">2. Cache Hit Rate SLI</a></li>
                <li><a href="#3-availability-sli" class="level-4">3. Availability SLI</a></li>
                <li><a href="#4-error-rate-sli" class="level-4">4. Error Rate SLI</a></li>
                <li><a href="#slos-service-level-objectives" class="level-3">SLOs (Service Level Objectives)</a></li>
                <li><a href="#error-budget-policy" class="level-3">Error Budget Policy</a></li>
                <li><a href="#capacity-planning" class="level-2">Capacity Planning</a></li>
                <li><a href="#current-capacity" class="level-3">Current Capacity</a></li>
                <li><a href="#scaling-strategy" class="level-3">Scaling Strategy</a></li>
                <li><a href="#capacity-forecasting" class="level-3">Capacity Forecasting</a></li>
                <li><a href="#failure-modes-blast-radius" class="level-2">Failure Modes &amp; Blast Radius</a></li>
                <li><a href="#cdn-failures" class="level-3">CDN Failures</a></li>
                <li><a href="#scenario-1-cdn-edge-failure" class="level-4">Scenario 1: CDN Edge Failure</a></li>
                <li><a href="#scenario-2-origin-server-failure" class="level-4">Scenario 2: Origin Server Failure</a></li>
                <li><a href="#scenario-3-storage-failure" class="level-4">Scenario 3: Storage Failure</a></li>
                <li><a href="#cache-failures" class="level-3">Cache Failures</a></li>
                <li><a href="#scenario-1-cache-miss-storm" class="level-4">Scenario 1: Cache Miss Storm</a></li>
                <li><a href="#scenario-2-stale-cache" class="level-4">Scenario 2: Stale Cache</a></li>
                <li><a href="#overload-scenarios" class="level-3">Overload Scenarios</a></li>
                <li><a href="#10-normal-load-1b-requestsday" class="level-4">10× Normal Load (1B requests/day)</a></li>
                <li><a href="#100-normal-load-10b-requestsday" class="level-4">100× Normal Load (10B requests/day)</a></li>
                <li><a href="#observability" class="level-2">Observability</a></li>
                <li><a href="#metrics" class="level-3">Metrics</a></li>
                <li><a href="#cdn-metrics" class="level-4">CDN Metrics</a></li>
                <li><a href="#origin-metrics" class="level-4">Origin Metrics</a></li>
                <li><a href="#storage-metrics" class="level-4">Storage Metrics</a></li>
                <li><a href="#dashboards" class="level-3">Dashboards</a></li>
                <li><a href="#logs" class="level-3">Logs</a></li>
                <li><a href="#alerts" class="level-3">Alerts</a></li>
                <li><a href="#deployment-rollout-strategy" class="level-2">Deployment &amp; Rollout Strategy</a></li>
                <li><a href="#deployment-process" class="level-3">Deployment Process</a></li>
                <li><a href="#cache-invalidation-strategy" class="level-3">Cache Invalidation Strategy</a></li>
                <li><a href="#security" class="level-2">Security</a></li>
                <li><a href="#authentication-authorization" class="level-3">Authentication &amp; Authorization</a></li>
                <li><a href="#data-protection" class="level-3">Data Protection</a></li>
                <li><a href="#cost-optimization" class="level-2">Cost Optimization</a></li>
                <li><a href="#cost-breakdown" class="level-3">Cost Breakdown</a></li>
                <li><a href="#optimization-strategies" class="level-3">Optimization Strategies</a></li>
                <li><a href="#incident-response-playbook" class="level-2">Incident Response Playbook</a></li>
                <li><a href="#common-incidents" class="level-3">Common Incidents</a></li>
                <li><a href="#incident-1-low-cache-hit-rate" class="level-4">Incident 1: Low Cache Hit Rate</a></li>
                <li><a href="#incident-2-stale-content" class="level-4">Incident 2: Stale Content</a></li>
                <li><a href="#further-reading" class="level-2">Further Reading</a></li>
                <li><a href="#exercises" class="level-2">Exercises</a></li>
            </ul>
        </div>
    </aside>
    <main class="main-content container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="content">
<h1 id="global-content-delivery-system">Global Content Delivery System</h1>
<p><strong>One-line summary</strong>: End-to-end design of a global CDN system on GCP using Cloud CDN, load balancing, and cache invalidation with SLOs, edge caching strategies, and consistency guarantees.</p>
<p><strong>Prerequisites</strong>: <a href="../03-gcp-core-building-blocks/vpc-lb-dns.html">VPC, Load Balancing &amp; DNS</a>, <a href="../03-gcp-core-building-blocks/cloud-storage.html">Cloud Storage Deep Dive</a>, <a href="../04-reliability-sre/index.html">Reliability &amp; SRE</a>.</p>
<hr />
<h2 id="system-overview">System Overview</h2>
<h3 id="requirements">Requirements</h3>
<p><strong>Functional Requirements</strong>:
- Serve static content (images, videos, CSS, JS) globally
- Support dynamic content (API responses, personalized content)
- Handle 100M+ requests per day
- Support multiple content types (images, videos, documents)</p>
<p><strong>Non-Functional Requirements</strong>:
- <strong>Latency</strong>: P95 &lt; 100ms (edge to user)
- <strong>Throughput</strong>: Handle 10K+ requests/second peak
- <strong>Availability</strong>: 99.9% (SLO)
- <strong>Cache hit rate</strong>: &gt; 80% (SLO)
- <strong>Consistency</strong>: Eventual consistency (acceptable for content)</p>
<p><strong>Constraints</strong>:
- Must use GCP services
- Cost-effective at scale
- Support cache invalidation</p>
<hr />
<h2 id="architecture">Architecture</h2>
<h3 id="high-level-architecture">High-Level Architecture</h3>
<div class="mermaid">
graph TB
Users[Users<br/>Global] --> CDN[Cloud CDN<br/>Edge Caches]
CDN --> LB[Global Load Balancer<br/>HTTP(S)]
LB --> Origin1[Origin Server 1<br/>us-central1]
LB --> Origin2[Origin Server 2<br/>europe-west1]
LB --> Origin3[Origin Server 3<br/>asia-east1]
Origin1 --> Storage1[Cloud Storage<br/>us-central1]
Origin2 --> Storage2[Cloud Storage<br/>europe-west1]
Origin3 --> Storage3[Cloud Storage<br/>asia-east1]
Origin1 --> API[API Server<br/>Dynamic Content]
Origin2 --> API
Origin3 --> API
API --> DB[(Database<br/>Spanner)]
style CDN fill:#99ccff
style LB fill:#ffcc99
style Storage1 fill:#99ff99
</div>
<h3 id="component-details">Component Details</h3>
<h4 id="1-cloud-cdn">1. Cloud CDN</h4>
<ul>
<li><strong>Type</strong>: Google's global CDN</li>
<li><strong>Edge locations</strong>: 100+ edge locations worldwide</li>
<li><strong>Caching</strong>: Cache static and dynamic content</li>
<li><strong>Configuration</strong>:</li>
<li>Cache TTL: Configurable per content type</li>
<li>Cache keys: URL + query parameters</li>
<li>Compression: Automatic compression</li>
</ul>
<h4 id="2-global-load-balancer">2. Global Load Balancer</h4>
<ul>
<li><strong>Type</strong>: HTTP(S) Global Load Balancer</li>
<li><strong>SSL</strong>: Managed SSL certificates</li>
<li><strong>Routing</strong>: Geographic routing (closest origin)</li>
<li><strong>Health checks</strong>: HTTP health checks every 10s</li>
</ul>
<h4 id="3-origin-servers">3. Origin Servers</h4>
<ul>
<li><strong>Platform</strong>: GKE (Google Kubernetes Engine)</li>
<li><strong>Regions</strong>: us-central1, europe-west1, asia-east1</li>
<li><strong>Functions</strong>:</li>
<li>Serve static content from Cloud Storage</li>
<li>Generate dynamic content via API</li>
<li>Handle cache invalidation</li>
</ul>
<h4 id="4-cloud-storage">4. Cloud Storage</h4>
<ul>
<li><strong>Buckets</strong>: Regional buckets (one per region)</li>
<li><strong>Storage class</strong>: Standard (frequently accessed)</li>
<li><strong>CORS</strong>: Configured for web access</li>
<li><strong>Lifecycle</strong>: Automatic lifecycle management</li>
</ul>
<h4 id="5-api-server">5. API Server</h4>
<ul>
<li><strong>Function</strong>: Generate dynamic content</li>
<li><strong>Database</strong>: Cloud Spanner (multi-region)</li>
<li><strong>Caching</strong>: In-memory cache for API responses</li>
</ul>
<hr />
<h2 id="data-flow">Data Flow</h2>
<h3 id="static-content-flow">Static Content Flow</h3>
<div class="mermaid">
sequenceDiagram
participant User
participant CDN
participant LB
participant Origin
participant Storage
User->>CDN: GET /images/photo.jpg
alt Cache hit
CDN-->>User: Return cached content
else Cache miss
CDN->>LB: Request content
LB->>Origin: Route to nearest origin
Origin->>Storage: Get object
Storage-->>Origin: Return object
Origin->>CDN: Return content + cache headers
CDN->>CDN: Cache content
CDN-->>User: Return content
end
</div>
<h3 id="dynamic-content-flow">Dynamic Content Flow</h3>
<div class="mermaid">
sequenceDiagram
participant User
participant CDN
participant LB
participant Origin
participant API
participant DB
User->>CDN: GET /api/user/123
alt Cache hit
CDN-->>User: Return cached response
else Cache miss
CDN->>LB: Request content
LB->>Origin: Route to nearest origin
Origin->>API: Generate dynamic content
API->>DB: Query database
DB-->>API: Return data
API-->>Origin: Return response + cache headers
Origin->>CDN: Return response + cache headers
CDN->>CDN: Cache response (if cacheable)
CDN-->>User: Return response
end
</div>
<h3 id="cache-invalidation-flow">Cache Invalidation Flow</h3>
<div class="mermaid">
sequenceDiagram
participant Admin
participant Origin
participant CDN
participant Cache
Admin->>Origin: Invalidate cache
Origin->>CDN: Purge cache (URL pattern)
CDN->>Cache: Remove cached content
Cache-->>CDN: Confirmed
CDN-->>Origin: Cache purged
Origin-->>Admin: Cache invalidated
</div>
<hr />
<h2 id="slis-slos-error-budgets">SLIs, SLOs &amp; Error Budgets</h2>
<h3 id="slis-service-level-indicators">SLIs (Service Level Indicators)</h3>
<h4 id="1-latency-sli">1. Latency SLI</h4>
<ul>
<li><strong>Definition</strong>: Time from request to response (edge to user)</li>
<li><strong>Measurement</strong>: P95 latency</li>
<li><strong>Current</strong>: P95 = 80ms</li>
<li><strong>Target</strong>: P95 &lt; 100ms (SLO)</li>
</ul>
<h4 id="2-cache-hit-rate-sli">2. Cache Hit Rate SLI</h4>
<ul>
<li><strong>Definition</strong>: Fraction of requests served from cache</li>
<li><strong>Measurement</strong>: Cache hits / total requests</li>
<li><strong>Current</strong>: 85%</li>
<li><strong>Target</strong>: &gt; 80% (SLO)</li>
</ul>
<h4 id="3-availability-sli">3. Availability SLI</h4>
<ul>
<li><strong>Definition</strong>: Fraction of successful HTTP requests (2xx, 3xx)</li>
<li><strong>Measurement</strong>: Successful requests / total requests</li>
<li><strong>Current</strong>: 99.95%</li>
<li><strong>Target</strong>: 99.9% (SLO)</li>
</ul>
<h4 id="4-error-rate-sli">4. Error Rate SLI</h4>
<ul>
<li><strong>Definition</strong>: Fraction of requests returning 5xx errors</li>
<li><strong>Measurement</strong>: 5xx errors / total requests</li>
<li><strong>Current</strong>: 0.05%</li>
<li><strong>Target</strong>: &lt; 0.1% (SLO)</li>
</ul>
<h3 id="slos-service-level-objectives">SLOs (Service Level Objectives)</h3>
<table>
<thead>
<tr>
<th>SLI</th>
<th>SLO</th>
<th>Error Budget</th>
</tr>
</thead>
<tbody>
<tr>
<td>Latency</td>
<td>P95 &lt; 100ms</td>
<td>&gt; 100ms for &gt; 0.1% requests</td>
</tr>
<tr>
<td>Cache Hit Rate</td>
<td>&gt; 80%</td>
<td>&lt; 80% for &gt; 0.1% requests</td>
</tr>
<tr>
<td>Availability</td>
<td>99.9%</td>
<td>&lt; 99.9% for &gt; 0.1% time</td>
</tr>
<tr>
<td>Error Rate</td>
<td>&lt; 0.1%</td>
<td>&gt; 0.1% for &gt; 0.1% requests</td>
</tr>
</tbody>
</table>
<h3 id="error-budget-policy">Error Budget Policy</h3>
<p><strong>Policy</strong>:
- <strong>&gt; 50% remaining</strong>: Normal operations, can ship features
- <strong>25-50% remaining</strong>: Warning, reduce risky changes
- <strong>&lt; 25% remaining</strong>: Critical, stop feature work, focus on reliability
- <strong>0% remaining</strong>: Emergency, only reliability work</p>
<hr />
<h2 id="capacity-planning">Capacity Planning</h2>
<h3 id="current-capacity">Current Capacity</h3>
<p><strong>CDN</strong>:
- <strong>Edge locations</strong>: 100+ locations worldwide
- <strong>Throughput</strong>: Unlimited (scales automatically)
- <strong>Cache capacity</strong>: Petabytes</p>
<p><strong>Load Balancer</strong>:
- <strong>Throughput</strong>: Millions of requests/second
- <strong>Regions</strong>: 3 regions (us, eu, asia)</p>
<p><strong>Origin Servers</strong>:
- <strong>Per region</strong>: 10 pods (can scale to 50)
- <strong>QPS capacity</strong>: ~10K QPS per region (can scale to 50K)
- <strong>Total</strong>: ~30K QPS (can scale to 150K)</p>
<p><strong>Storage</strong>:
- <strong>Per region</strong>: Petabytes
- <strong>Throughput</strong>: Millions of requests/second</p>
<h3 id="scaling-strategy">Scaling Strategy</h3>
<p><strong>Auto-scaling</strong>:
- <strong>CDN</strong>: Automatic (handles load)
- <strong>Load Balancer</strong>: Automatic (handles load)
- <strong>Origin Servers</strong>: Auto-scaling based on load
- <strong>Storage</strong>: Automatic (handles load)</p>
<p><strong>Manual scaling</strong>:
- <strong>Origin Servers</strong>: Adjust min/max replicas if needed</p>
<h3 id="capacity-forecasting">Capacity Forecasting</h3>
<p><strong>Growth Projection</strong>:
- <strong>Current</strong>: 50M requests/day average, 100M peak
- <strong>Growth</strong>: 25% per quarter
- <strong>6 months</strong>: ~78M requests/day average, ~156M peak
- <strong>12 months</strong>: ~122M requests/day average, ~244M peak</p>
<p><strong>Capacity Needs</strong>:
- <strong>6 months</strong>: Need to handle ~200M requests/day peak
- <strong>12 months</strong>: Need to handle ~300M requests/day peak
- <strong>Plan</strong>: Optimize caching, scale origin servers</p>
<hr />
<h2 id="failure-modes-blast-radius">Failure Modes &amp; Blast Radius</h2>
<h3 id="cdn-failures">CDN Failures</h3>
<h4 id="scenario-1-cdn-edge-failure">Scenario 1: CDN Edge Failure</h4>
<ul>
<li><strong>Impact</strong>: Requests routed to other edges, may see increased latency</li>
<li><strong>Blast radius</strong>: Users near failed edge</li>
<li><strong>Detection</strong>: Edge health checks fail, latency increases</li>
<li><strong>Recovery</strong>: </li>
<li>Automatic failover to other edges</li>
<li>Edge restored automatically</li>
<li><strong>Mitigation</strong>: </li>
<li>Multiple edge locations</li>
<li>Automatic failover</li>
</ul>
<h4 id="scenario-2-origin-server-failure">Scenario 2: Origin Server Failure</h4>
<ul>
<li><strong>Impact</strong>: Cannot serve content, cache misses increase</li>
<li><strong>Blast radius</strong>: Affected region</li>
<li><strong>Detection</strong>: Origin health checks fail, error rate increases</li>
<li><strong>Recovery</strong>: </li>
<li>Load balancer routes to other regions</li>
<li>Origin restored automatically</li>
<li>Cache helps during recovery</li>
<li><strong>Mitigation</strong>: </li>
<li>Multi-region deployment</li>
<li>Health checks</li>
<li>Auto-scaling</li>
</ul>
<h4 id="scenario-3-storage-failure">Scenario 3: Storage Failure</h4>
<ul>
<li><strong>Impact</strong>: Cannot serve static content, cache misses increase</li>
<li><strong>Blast radius</strong>: Affected region</li>
<li><strong>Detection</strong>: Storage errors, cache misses increase</li>
<li><strong>Recovery</strong>: </li>
<li>Storage automatically recovers</li>
<li>Cache helps during recovery</li>
<li><strong>Mitigation</strong>: </li>
<li>Storage redundancy</li>
<li>Multi-region storage</li>
<li>Cache helps reduce impact</li>
</ul>
<h3 id="cache-failures">Cache Failures</h3>
<h4 id="scenario-1-cache-miss-storm">Scenario 1: Cache Miss Storm</h4>
<ul>
<li><strong>Impact</strong>: High origin load, increased latency</li>
<li><strong>Blast radius</strong>: All requests</li>
<li><strong>Detection</strong>: Cache hit rate drops, origin load increases</li>
<li><strong>Recovery</strong>: </li>
<li>Cache warms up over time</li>
<li>Scale origin servers if needed</li>
<li><strong>Mitigation</strong>: </li>
<li>Pre-warm cache</li>
<li>Optimize cache TTL</li>
<li>Monitor cache hit rate</li>
</ul>
<h4 id="scenario-2-stale-cache">Scenario 2: Stale Cache</h4>
<ul>
<li><strong>Impact</strong>: Users see stale content</li>
<li><strong>Blast radius</strong>: Cached content</li>
<li><strong>Detection</strong>: Users report stale content</li>
<li><strong>Recovery</strong>: </li>
<li>Invalidate cache</li>
<li>Update cache TTL</li>
<li><strong>Mitigation</strong>: </li>
<li>Proper cache invalidation</li>
<li>Monitor cache freshness</li>
<li>Use cache versioning</li>
</ul>
<h3 id="overload-scenarios">Overload Scenarios</h3>
<h4 id="10-normal-load-1b-requestsday">10× Normal Load (1B requests/day)</h4>
<ul>
<li><strong>Impact</strong>: </li>
<li>CDN: Handles load, may see increased latency</li>
<li>Origin: May need scaling, cache helps</li>
<li>Storage: Handles load</li>
<li><strong>Mitigation</strong>: </li>
<li>Auto-scaling handles load</li>
<li>Cache reduces origin load</li>
<li>Monitor performance</li>
</ul>
<h4 id="100-normal-load-10b-requestsday">100× Normal Load (10B requests/day)</h4>
<ul>
<li><strong>Impact</strong>: </li>
<li>CDN: Handles load, may see increased latency</li>
<li>Origin: Significant scaling needed</li>
<li>Storage: Handles load</li>
<li><strong>Mitigation</strong>: </li>
<li>Significant scaling required</li>
<li>Optimize caching</li>
<li>May need more regions</li>
</ul>
<hr />
<h2 id="observability">Observability</h2>
<h3 id="metrics">Metrics</h3>
<h4 id="cdn-metrics">CDN Metrics</h4>
<ul>
<li><strong>Request rate</strong>: Requests per second</li>
<li><strong>Cache hit rate</strong>: Cache hits / total requests</li>
<li><strong>Latency</strong>: P50/P95/P99 latency</li>
<li><strong>Error rate</strong>: 4xx/5xx errors</li>
<li><strong>Bandwidth</strong>: Bandwidth usage</li>
</ul>
<h4 id="origin-metrics">Origin Metrics</h4>
<ul>
<li><strong>Request rate</strong>: Requests per second</li>
<li><strong>Latency</strong>: P50/P95/P99 latency</li>
<li><strong>Error rate</strong>: 4xx/5xx errors</li>
<li><strong>Cache miss rate</strong>: Cache misses / total requests</li>
</ul>
<h4 id="storage-metrics">Storage Metrics</h4>
<ul>
<li><strong>Request rate</strong>: Requests per second</li>
<li><strong>Latency</strong>: P50/P95/P99 latency</li>
<li><strong>Error rate</strong>: 4xx/5xx errors</li>
<li><strong>Storage size</strong>: Total storage size</li>
</ul>
<h3 id="dashboards">Dashboards</h3>
<p><strong>CDN Dashboard</strong>:
- Request rate, cache hit rate, latency
- Error rate, bandwidth
- SLO compliance, error budget</p>
<p><strong>Origin Dashboard</strong>:
- Request rate, latency, error rate
- Cache miss rate, origin load</p>
<p><strong>Storage Dashboard</strong>:
- Request rate, latency, error rate
- Storage size, storage costs</p>
<h3 id="logs">Logs</h3>
<p><strong>CDN Logs</strong>:
- Access logs (if enabled)
- Error logs
- Cache hit/miss logs</p>
<p><strong>Origin Logs</strong>:
- Access logs
- Error logs
- Cache invalidation logs</p>
<h3 id="alerts">Alerts</h3>
<p><strong>Critical Alerts</strong>:
- CDN unavailable
- High error rate (&gt; 1%)
- Cache hit rate &lt; 70%
- SLO violation</p>
<p><strong>Warning Alerts</strong>:
- High latency
- Cache hit rate decreasing
- Origin load increasing
- Storage errors</p>
<hr />
<h2 id="deployment-rollout-strategy">Deployment &amp; Rollout Strategy</h2>
<h3 id="deployment-process">Deployment Process</h3>
<p><strong>Static Content</strong>:
1. <strong>Upload</strong>: Upload to Cloud Storage
2. <strong>Invalidate</strong>: Invalidate CDN cache (if needed)
3. <strong>Verify</strong>: Verify content served correctly</p>
<p><strong>Dynamic Content</strong>:
1. <strong>Deploy</strong>: Deploy API changes
2. <strong>Canary</strong>: Deploy to canary (5% traffic)
3. <strong>Monitor</strong>: Monitor for issues
4. <strong>Rollout</strong>: Gradual rollout (25%, 50%, 100%)</p>
<h3 id="cache-invalidation-strategy">Cache Invalidation Strategy</h3>
<p><strong>Invalidation Methods</strong>:
- <strong>URL invalidation</strong>: Invalidate specific URLs
- <strong>Path invalidation</strong>: Invalidate URL patterns
- <strong>Full invalidation</strong>: Invalidate all cache (rare)</p>
<p><strong>Best Practices</strong>:
- <strong>Versioned URLs</strong>: Use versioned URLs (e.g., <code>/v1/image.jpg</code>)
- <strong>Selective invalidation</strong>: Invalidate only changed content
- <strong>Scheduled invalidation</strong>: Invalidate during low traffic</p>
<hr />
<h2 id="security">Security</h2>
<h3 id="authentication-authorization">Authentication &amp; Authorization</h3>
<p><strong>CDN</strong>:
- <strong>Signed URLs</strong>: Use signed URLs for private content
- <strong>Access control</strong>: IAM policies for Cloud Storage</p>
<p><strong>Origin</strong>:
- <strong>IAM</strong>: IAM policies for origin servers
- <strong>Service accounts</strong>: Use service accounts</p>
<h3 id="data-protection">Data Protection</h3>
<p><strong>Encryption</strong>:
- <strong>At rest</strong>: All data encrypted (Cloud Storage)
- <strong>In transit</strong>: TLS for all connections
- <strong>CDN</strong>: TLS termination at CDN</p>
<p><strong>DDoS Protection</strong>:
- <strong>Cloud Armor</strong>: WAF and DDoS protection
- <strong>Rate limiting</strong>: Rate limiting per IP/client</p>
<hr />
<h2 id="cost-optimization">Cost Optimization</h2>
<h3 id="cost-breakdown">Cost Breakdown</h3>
<p><strong>Monthly Costs</strong> (estimated for 100M requests/day):
- <strong>CDN</strong>: $3,000 (egress, cache)
- <strong>Load Balancer</strong>: $500 (traffic)
- <strong>Origin Servers</strong>: $2,000 (compute)
- <strong>Storage</strong>: $1,000 (storage, egress)
- <strong>Total</strong>: ~$6,500/month</p>
<h3 id="optimization-strategies">Optimization Strategies</h3>
<ol>
<li><strong>CDN</strong>: Optimize cache hit rate, reduce origin load</li>
<li><strong>Storage</strong>: Use appropriate storage classes, lifecycle policies</li>
<li><strong>Origin</strong>: Optimize origin performance, reduce compute</li>
<li><strong>Caching</strong>: Optimize cache TTL, reduce cache misses</li>
</ol>
<hr />
<h2 id="incident-response-playbook">Incident Response Playbook</h2>
<h3 id="common-incidents">Common Incidents</h3>
<h4 id="incident-1-low-cache-hit-rate">Incident 1: Low Cache Hit Rate</h4>
<p><strong>Symptoms</strong>:
- Cache hit rate &lt; 70%
- High origin load
- Increased latency</p>
<p><strong>Response</strong>:
1. <strong>Acknowledge</strong>: Acknowledge incident
2. <strong>Assess</strong>: Check cache hit rate, origin load
3. <strong>Mitigate</strong>: 
   - Optimize cache TTL
   - Pre-warm cache
   - Scale origin servers
4. <strong>Investigate</strong>: Root cause analysis
5. <strong>Resolve</strong>: Fix root cause
6. <strong>Postmortem</strong>: Write postmortem</p>
<h4 id="incident-2-stale-content">Incident 2: Stale Content</h4>
<p><strong>Symptoms</strong>:
- Users report stale content
- Cache not invalidated</p>
<p><strong>Response</strong>:
1. <strong>Acknowledge</strong>: Acknowledge incident
2. <strong>Assess</strong>: Check cache invalidation logs
3. <strong>Mitigate</strong>: 
   - Invalidate cache immediately
   - Fix cache invalidation process
4. <strong>Investigate</strong>: Root cause analysis
5. <strong>Resolve</strong>: Fix root cause
6. <strong>Postmortem</strong>: Write postmortem</p>
<hr />
<h2 id="further-reading">Further Reading</h2>
<p><strong>Comprehensive Guide</strong>: <a href="../further-reading/cdn-system.html">Further Reading: CDN System</a></p>
<p><strong>Quick Links</strong>:
- <a href="https://cloud.google.com/cdn/docs">Cloud CDN Documentation</a>
- <a href="https://cloud.google.com/load-balancing/docs">Load Balancing Documentation</a>
- <a href="https://cloud.google.com/storage/docs">Cloud Storage Documentation</a>
- <a href="../03-gcp-core-building-blocks/vpc-lb-dns.html">VPC, LB &amp; DNS</a>
- <a href="index.html">Back to Case Studies</a></p>
<hr />
<h2 id="exercises">Exercises</h2>
<ol>
<li>
<p><strong>Design improvements</strong>: How would you improve this design? What tradeoffs?</p>
</li>
<li>
<p><strong>Handle cache invalidation</strong>: How do you handle cache invalidation for frequently updated content?</p>
</li>
<li>
<p><strong>Optimize costs</strong>: How would you reduce costs by 30%? What tradeoffs?</p>
</li>
</ol>
<p><strong>Answer Key</strong>: <a href="../exercises/answers/cdn-system-answers.html">View Answers</a></p>
        </div>
    </main>
    <footer class="bg-gray-800 text-white text-center p-6 mt-16">
        <p>&copy; 2025 Data Engineering Guides. An illustrative web application.</p>
    </footer>
    <script src="../../assets/scripts.js"></script>
    
</body>
</html>
