<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Databricks Explained</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            color: #333;
        }
        .section-header {
            background-color: #4f46e5; /* Indigo */
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }
        .section-header:hover {
            background-color: #4338ca; /* Darker indigo on hover */
        }
        .section-content {
            background-color: #f8fafc; /* Lighter background for content */
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0; /* Light border */
        }
        .accordion-icon {
            transition: transform 0.3s ease;
        }
        .accordion-icon.rotated {
            transform: rotate(90deg);
        }
        .cheatsheet-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px dashed #cbd5e1;
        }
        .cheatsheet-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .cheatsheet-item h4 {
            font-weight: 600;
            color: #4f46e5;
            margin-bottom: 0.5rem;
        }
        /* Responsive Table Styles */
        @media (max-width: 767px) {
            .responsive-table thead {
                display: none;
            }
            .responsive-table tbody, .responsive-table tr, .responsive-table td {
                display: block;
                width: 100%;
            }
            .responsive-table tr {
                margin-bottom: 1rem;
                border: 1px solid #e2e8f0;
                border-radius: 0.5rem;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            }
            .responsive-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: right;
                padding: 0.75rem 1rem;
                border-bottom: 1px solid #e2e8f0;
            }
            .responsive-table td::before {
                content: attr(data-label);
                text-align: left;
                font-weight: 600;
                color: #4f46e5; /* Indigo */
                padding-right: 1rem;
                white-space: nowrap;
            }
            .responsive-table td:last-child {
                border-bottom: none;
            }
        }
    </style>
</head>
<body class="antialiased">
    <header class="bg-white sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
            <div class="text-xl sm:text-2xl font-bold text-gray-800">
                <a href="index.html" class="flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                    <span class="gradient-text">Back to Databricks Topics</span>
                </a>
            </div>
            <ul class="flex space-x-4 sm:space-x-6 text-gray-600 font-medium text-sm sm:text-base">
                <li><a href="../aboutme.html" class="hover:text-[#FF3621] font-semibold">About Me</a></li>
            </ul>
        </nav>
    </header>
    <div class="container mx-auto max-w-5xl p-4 sm:p-6">
        <h1 class="text-3xl sm:text-4xl font-bold text-center mb-8 text-indigo-700">Understanding Databricks & Lakehouse Architecture</h1>

        <!-- What is Databricks? -->
        <div class="mb-6">
            <div class="section-header" onclick="toggleSection('what-is-databricks')">
                <h2 class="text-xl sm:text-2xl font-semibold">What is Databricks?</h2>
                <span class="accordion-icon text-2xl font-bold" id="what-is-databricks-icon">+</span>
            </div>
            <div id="what-is-databricks-content" class="section-content hidden">
                <p class="mb-4">Databricks is a cloud-based data and AI company that provides a unified platform for data engineering, machine learning, and data warehousing. Built on top of Apache Spark, it simplifies big data analytics and AI development by offering a collaborative environment with optimized performance.</p>
                <p>It aims to solve the challenges of traditional data architectures by combining the best aspects of data lakes (scalability, flexibility) and data warehouses (structure, performance, governance) into a single system – the Lakehouse.</p>
            </div>
        </div>

        <!-- Lakehouse Architecture -->
        <div class="mb-6">
            <div class="section-header" onclick="toggleSection('lakehouse-architecture')">
                <h2 class="text-2xl font-semibold">The Lakehouse Architecture</h2>
                <span class="accordion-icon text-2xl font-bold" id="lakehouse-architecture-icon">+</span>
            </div>
            <div id="lakehouse-architecture-content" class="section-content hidden">
                <p class="mb-4">The Lakehouse architecture is a new, open data management paradigm that combines the best features of data lakes and data warehouses. It's designed to handle all types of data (structured, semi-structured, unstructured) and support all data workloads (BI, AI, ML) on a single platform.</p>
                <h3 class="text-xl font-semibold mb-2 text-indigo-600">Key Components of Databricks Lakehouse:</h3>
                <ul class="list-disc list-inside mb-4 pl-4">
                    <li class="mb-2"><strong>Delta Lake:</strong> An open-source storage layer built on open formats (Parquet) that brings ACID transactions, schema enforcement, and data versioning (Time Travel) to your data lake. This is the core component that adds reliability and performance.</li>
                    <li class="mb-2"><strong>Photon Engine:</strong> A high-performance, C++ based vectorized query engine that is compatible with Apache Spark APIs. Instead of processing data row-by-row, Photon processes data in batches (vectors), taking full advantage of modern CPU hardware (SIMD). This results in significant performance improvements for SQL and DataFrame operations.</li>
                    <li class="mb-2"><strong>Unity Catalog:</strong> A unified governance solution for data and AI assets across multiple workspaces and clouds. It provides a central place to manage permissions, auditing, and data lineage, treating the Lakehouse as a single, governable entity.</li>
                </ul>
                <h3 class="text-xl font-semibold mb-2 text-indigo-600">Why Lakehouse?</h3>
                <p class="mb-4">Traditional architectures often lead to data silos (data lakes for raw data, data warehouses for structured BI). The Lakehouse eliminates these silos, offering:</p>
                <ul class="list-disc list-inside pl-4">
                    <li class="mb-1"><strong>Simplicity:</strong> One copy of data for all workloads.</li>
                    <li class="mb-1"><strong>Performance:</strong> Optimized for both SQL analytics and AI/ML.</li>
                    <li class="mb-1"><strong>Reliability:</strong> ACID transactions ensure data integrity.</li>
                    <li class="mb-1"><strong>Openness:</strong> Built on open formats like Parquet and Delta Lake.</li>
                    <li class="mb-1"><strong>Governance:</strong> Centralized security and auditing with Unity Catalog.</li>
                </ul>
                <!-- Simple Diagram Idea (Text-based for now) -->
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="font-bold text-blue-800 mb-2">Lakehouse Simplified Flow:</h4>
                    <pre class="bg-gray-100 p-3 rounded text-sm overflow-x-auto">
Raw Data (e.g., CSV, JSON, Logs)
        |
        V
Data Lake (Cloud Storage - S3, ADLS, GCS)
        | (Managed by Delta Lake)
        V
Bronze Layer (Raw, Ingested Data)
        | (ETL/ELT with Spark/Photon)
        V
Silver Layer (Cleaned, Filtered, Transformed Data)
        | (Further Transformation/Aggregation)
        V
Gold Layer (Aggregated, Business-Ready Data for BI/ML)
        |
        V
BI Tools / ML Models / Data Science
                    </pre>
                </div>
            </div>
        </div>

        <!-- Databricks SQL -->
        <div class="mb-6">
            <div class="section-header" onclick="toggleSection('databricks-sql')">
                <h2 class="text-2xl font-semibold">Databricks SQL Serverless</h2>
                <span class="accordion-icon text-2xl font-bold" id="databricks-sql-icon">+</span>
            </div>
            <div id="databricks-sql-content" class="section-content hidden">
                <p class="mb-4">Databricks SQL is a serverless data warehouse built on the Lakehouse architecture. It provides a familiar SQL interface for data analysts to run queries on the same data used for data science and machine learning, eliminating data silos and reducing complexity.</p>
                <h3 class="text-xl font-semibold mb-2 text-indigo-600">Key Benefits:</h3>
                <ul class="list-disc list-inside mb-4 pl-4">
                    <li class="mb-2"><strong>Serverless Compute:</strong> Instant, elastic compute that starts up and shuts down in seconds, so you only pay for the queries you run.</li>
                    <li class="mb-2"><strong>High Performance:</strong> Powered by the Photon engine, it delivers leading price/performance for BI and SQL workloads.</li>
                    <li class="mb-2"><strong>Unified Governance:</strong> Integrated with Unity Catalog for end-to-end governance, from data ingestion to BI dashboards.</li>
                    <li class="mb-2"><strong>BI Tool Integration:</strong> Seamlessly connects with popular BI tools like Tableau, Power BI, and Looker.</li>
                </ul>
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="font-bold text-blue-800 mb-2">Example: Connecting Power BI to Gold Layer</h4>
                    <pre class="bg-gray-100 p-3 rounded text-sm overflow-x-auto">
1. Open Power BI Desktop.
2. Get Data -> Azure -> Azure Databricks.
3. Enter Server Hostname and HTTP Path from your DBSQL endpoint.
4. Authenticate (e.g., with Azure AD or a Personal Access Token).
5. Navigate to your Gold catalog and select the 'quarterly_sales' table.
6. Start building visualizations on live, governed data.
                    </pre>
                </div>
            </div>
        </div>

        <!-- Medallion Architecture In-Depth -->
        <div class="mb-6">
            <div class="section-header" onclick="toggleSection('medallion-architecture')">
                <h2 class="text-2xl font-semibold">Medallion Architecture In-Depth</h2>
                <span class="accordion-icon text-2xl font-bold" id="medallion-architecture-icon">+</span>
            </div>
            <div id="medallion-architecture-content" class="section-content hidden">
                <p class="mb-4">The Medallion Architecture is a data design pattern for logically organizing data in a lakehouse. The goal is to incrementally and progressively improve the structure and quality of data as it flows through the layers (from Bronze to Silver to Gold).</p>
                <div class="overflow-x-auto">
                    <table class="w-full responsive-table">
                        <thead>
                            <tr>
                                <th class="p-3 text-left font-semibold text-sm text-indigo-800 bg-indigo-100">Layer</th>
                                <th class="p-3 text-left font-semibold text-sm text-indigo-800 bg-indigo-100">Purpose</th>
                                <th class="p-3 text-left font-semibold text-sm text-indigo-800 bg-indigo-100">Common Operations</th>
                                <th class="p-3 text-left font-semibold text-sm text-indigo-800 bg-indigo-100">Example</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr>
                                <td data-label="Layer" class="font-semibold">Bronze (Raw)</td>
                                <td data-label="Purpose">Ingest raw data from sources. Append-only, immutable. Provides a historical archive.</td>
                                <td data-label="Common Operations">Batch or stream ingestion (e.g., Auto Loader), schema inference.</td>
                                <td data-label="Example">JSON files from a Kafka topic landed as-is into a Delta table.</td>
                            </tr>
                            <tr>
                                <td data-label="Layer" class="font-semibold">Silver (Validated)</td>
                                <td data-label="Purpose">Cleaned, filtered, and enriched data. Provides a single source of truth for analytics.</td>
                                <td data-label="Common Operations">Deduplication, data type casting, handling nulls, joining with lookup tables.</td>
                                <td data-label="Example">User session data is cleaned, and user IDs are joined with a user dimension table.</td>
                            </tr>
                            <tr>
                                <td data-label="Layer" class="font-semibold">Gold (Aggregated)</td>
                                <td data-label="Purpose">Business-level aggregates, ready for BI and reporting. Optimized for performance.</td>
                                <td data-label="Common Operations">Aggregations (e.g., weekly sales), complex joins, feature engineering.</td>
                                <td data-label="Example">A 'quarterly_sales' table is created by aggregating the Silver-level sales data.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Unity Catalog In-Depth -->
        <div class="mb-6">
            <div class="section-header" onclick="toggleSection('unity-catalog')">
                <h2 class="text-2xl font-semibold">Unity Catalog In-Depth</h2>
                <span class="accordion-icon text-2xl font-bold" id="unity-catalog-icon">+</span>
            </div>
            <div id="unity-catalog-content" class="section-content hidden">
                <p class="mb-4">Unity Catalog is the comprehensive governance solution for the Databricks Lakehouse. It provides a centralized place to manage all data and AI assets, enabling fine-grained control and end-to-end lineage.</p>
                <h3 class="text-xl font-semibold mb-2 text-indigo-600">Core Features:</h3>
                <ul class="list-disc list-inside mb-4 pl-4">
                    <li class="mb-2"><strong>Centralized Metadata & 3-Level Namespace:</strong> One metastore to rule them all, spanning multiple workspaces. It introduces a three-level namespace (`catalog.schema.table`) for better data organization.</li>
                    <li class="mb-2"><strong>Fine-Grained Access Control:</strong> Use standard SQL GRANT/REVOKE statements to manage permissions on catalogs, schemas, tables, and views. It also supports Row-Level Security and Column-Level Masking.</li>
                    <li class="mb-2"><strong>Automated Data Lineage:</strong> Automatically captures and visualizes lineage for all queries, notebooks, and dashboards, down to the column level, across all languages.</li>
                    <li class="mb-2"><strong>Data Discovery:</strong> A built-in data explorer allows users to easily search for and discover relevant data assets using tags and metadata.</li>
                    <li class="mb-2"><strong>Secure Data Sharing:</strong> Use Delta Sharing, an open protocol, to securely share live data with other organizations without duplicating it, regardless of the platform they use.</li>
                    <li class="mb-2"><strong>Attribute Based Access Control (ABAC):</strong> Use tags to control access to data assets, simplifying governance at scale by grouping assets and principals by their attributes.</li>
                </ul>
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="font-bold text-blue-800 mb-2">Example: Granting Access with Unity Catalog</h4>
                    <pre class="bg-gray-100 p-3 rounded text-sm overflow-x-auto">
-- Grant usage on the catalog
GRANT USE_CATALOG ON CATALOG marketing_data TO `analysts`;

-- Grant usage on the schema
GRANT USE_SCHEMA ON SCHEMA marketing_data.web_analytics TO `analysts`;

-- Grant select on a specific table
GRANT SELECT ON TABLE marketing_data.web_analytics.page_views TO `analysts`;
                    </pre>
                </div>
            </div>
        </div>

        <!-- Delta Lake Internals -->
        <div class="mb-6">
            <div class="section-header" onclick="toggleSection('delta-lake-internals')">
                <h2 class="text-2xl font-semibold">Delta Lake Internals: The Transaction Log</h2>
                <span class="accordion-icon text-2xl font-bold" id="delta-lake-internals-icon">+</span>
            </div>
            <div id="delta-lake-internals-content" class="section-content hidden">
                <p class="mb-4">The power of Delta Lake comes from the `_delta_log` directory, which is stored alongside the data files (Parquet). This transaction log is the single source of truth that defines the state of a Delta table.</p>
                <h3 class="text-xl font-semibold mb-2 text-indigo-600">How it Works:</h3>
                <ul class="list-disc list-inside mb-4 pl-4">
                    <li class="mb-2"><strong>Ordered Atomic Commits:</strong> Every transaction (e.g., INSERT, UPDATE, DELETE, MERGE) is recorded as an ordered, atomic commit in the transaction log. Each commit produces a new JSON file (e.g., `000000.json`, `000001.json`).</li>
                    <li class="mb-2"><strong>Log Entries:</strong> These JSON files contain "actions" that describe changes to the table, such as adding or removing a data file, changing metadata (schema), or updating statistics.</li>
                    <li class="mb-2"><strong>Checkpoints:</strong> To avoid having to read thousands of small JSON files, Delta Lake periodically compacts the transaction log into a Parquet file called a checkpoint. This checkpoint contains the aggregated state of the table up to that point, providing a much faster way for readers to get the current state of the table.</li>
                    <li class="mb-2"><strong>ACID Transactions:</strong> The transaction log enables ACID properties. When a write occurs, Delta first writes the data files, then commits an entry to the log. This two-phase commit protocol ensures atomicity. The optimistic concurrency control model handles conflicts between concurrent writes.</li>
                </ul>
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="font-bold text-blue-800 mb-2">Example `_delta_log` Directory Structure:</h4>
                    <pre class="bg-gray-100 p-3 rounded text-sm overflow-x-auto">
/path/to/table/
  ├── _delta_log/
  │   ├── 000000.json
  │   ├── 000001.json
  │   ├── ...
  │   └── 000010.checkpoint.parquet
  ├── part-00000-....c000.snappy.parquet
  └── part-00001-....c000.snappy.parquet
                    </pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // JavaScript for accordion functionality
        function toggleSection(id) {
            const content = document.getElementById(id + '-content');
            const icon = document.getElementById(id + '-icon');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotated');
                icon.textContent = '-';
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotated');
                icon.textContent = '+';
            }
        }
    </script>
</body>
</html>
