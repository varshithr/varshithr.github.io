<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Dataflow (Apache Beam) Visual Deep Dive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .dataflow-cell {
            min-height: 4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            transition: all 0.3s ease;
            font-size: 0.75rem;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
            white-space: nowrap;
        }
        .header-cell {
            background-color: #1e3a8a; /* Dark Blue */
            color: white;
            font-weight: 600;
            border: 1px solid #172554;
        }
        .concept-cell {
            background-color: #dbeafe; /* Light Blue */
            color: #1e3a8a;
            font-weight: 700;
            text-align: left;
            padding-left: 1rem;
            cursor: pointer;
        }
        .data-cell {
            background-color: #ffffff;
            color: #1f2937;
            border: 1px solid #e5e7eb;
            font-size: 0.875rem;
            cursor: pointer;
        }
        /* Specific styling for concepts */
        .bounded-cell {
            background-color: #e0f2f7; /* Batch/Fixed */
            color: #0c4a6e;
            font-weight: 600;
        }
        .unbounded-cell {
            background-color: #f0fdf4; /* Streaming/Flow */
            color: #166534;
            font-weight: 600;
        }
        .time-event {
            background-color: #fef3c7; /* Yellow/Time */
            color: #92400e;
            font-weight: 700;
        }
        .time-processing {
            background-color: #fee2e2; /* Red/Late */
            color: #991b1b;
            font-weight: 700;
        }
        /* Responsive Table Styles */
        @media (max-width: 767px) {
            .responsive-table thead {
                display: none;
            }
            .responsive-table tbody, .responsive-table tr, .responsive-table td {
                display: block;
                width: 100%;
            }
            .responsive-table tr {
                margin-bottom: 1rem;
                border: 1px solid #e5e7eb;
                border-radius: 0.5rem;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
                background-color: white;
            }
            .responsive-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: right;
                padding: 0.75rem 1rem;
                border-bottom: 1px solid #e5e7eb;
            }
            .responsive-table td::before {
                content: attr(data-label);
                text-align: left;
                font-weight: 600;
                color: #1e3a8a; /* Dataflow blue */
                padding-right: 1rem;
                white-space: nowrap;
            }
            .responsive-table td:last-child {
                border-bottom: none;
            }
        }
    </style>
    <script>
        // Global State
        const state = {
            currentTab: 'architecture',
            message: "Click a concept tab above to explore the core components and abstractions of the Apache Beam programming model used by Dataflow.",
        };

        // Core Concepts Data
        const concepts = {
            architecture: {
                title: "Apache Beam Model (The Big Picture)",
                description: "The Beam model separates the job definition (Pipeline) from its execution (Runner), making the code portable across different platforms.",
                headers: ["Element", "Role", "Abstraction Level"],
                rows: [
                    { key: "SDK (Beam)", data: ["Define the pipeline (code)", "Programming Model"] },
                    { key: "PCollection", data: ["The data abstraction (data sets)", "What is being processed"] },
                    { key: "PTransform", data: ["The data processing abstraction (logic)", "What performs the processing"] },
                    { key: "Runner", data: ["Executes the pipeline on an engine", "How it is processed (e.g., Dataflow, Flink)"] },
                ]
            },
            pcollections: {
                title: "PCollections (Bounded vs. Unbounded Data)",
                description: "PCollections are the core data containers. A stream is unbounded; a file or database read is bounded.",
                headers: ["Type", "Characteristic", "Data Source Example"],
                rows: [
                    { key: "Bounded", data: ["Finite size, processed once (Batch)", "Cloud Storage file, BigQuery table"] },
                    { key: "Unbounded", data: ["Infinite, continuously processed (Stream)", "Pub/Sub topic, Kafka stream"] },
                    { key: "Implication", data: ["Requires no windowing/triggers", "Requires windowing, watermarks, and triggers"] },
                ]
            },
            transforms: {
                title: "PTransforms (Processing Logic)",
                description: "Transforms apply processing logic. **ParDo** (Parallel Do) is the most common, performing element-wise operations.",
                headers: ["Transform Type", "Function", "Analogy"],
                rows: [
                    { key: "ParDo (Element-wise)", data: ["Map, Filter, Formatting (1 Input -> 1/0/N Outputs)", "A factory assembly line worker"] },
                    { key: "GroupByKey (GBK)", data: ["Group elements by key for aggregation (Shuffle)", "Collecting all items of one color before packaging"] },
                    { key: "Combine", data: ["Aggregating values within a group (Sum, Average)", "Running the total on a group of items"] },
                ]
            },
            windowing: {
                title: "Windowing (Grouping Time-based Data)",
                description: "For unbounded streams, windowing slices the infinite data into finite groups based on event time.",
                headers: ["Window Type", "Grouping Logic", "Visual Representation"],
                rows: [
                    { key: "Fixed/Tumbling", data: ["Non-overlapping, equal-sized time blocks (e.g., 1-minute)", "| [1 min] | [1 min] | [1 min] |"] },
                    { key: "Sliding", data: ["Overlapping windows (e.g., 1 min window, 30 sec slide)", "|--- [1 min] ---| |--- [1 min] ---|"] },
                    { key: "Session", data: ["Group elements based on user activity gap (inactivity timeout)", "| Activity |--- Gap (5min) ---| | Activity |"] },
                ]
            },
            watermarks: {
                title: "Watermarks (Taming Event Time)",
                description: "The **Watermark** is Beam's estimate of when all data for a specific event time has arrived. It dictates when windows are 'ready.'",
                headers: ["Time Type", "Definition", "Watermark Implication"],
                rows: [
                    { key: "Event Time (T)", data: ["When the event actually happened (in the source system)", "This is the time used for windowing"] },
                    { key: "Processing Time (L)", data: ["When the dataflow worker processes the data", "Used for early/late firings"] },
                    { key: "Watermark (W)", data: ["Estimate of completeness for Event Time T", "When W passes T, the window is considered complete"] },
                ]
            },
            triggers: {
                title: "Triggers (When to Emit Results)",
                description: "Triggers determine *when* to emit the results of an aggregation within a windowâ€”before, at, or after the watermark passes.",
                headers: ["Trigger Type", "Firing Time (Relation to W)", "Purpose"],
                rows: [
                    { key: "Default (On Time)", data: ["Fires exactly when the watermark passes the window end.", "Final, complete result"] },
                    { key: "Early (Speculative)", data: ["Fires based on processing time or element count, before W.", "Low latency, partial result updates"] },
                    { key: "Late (Refining)", data: ["Fires when late data arrives, after W has passed.", "Refines previously emitted results (data correction)"] },
                ]
            },
            runners: {
                title: "Execution Runners (Dataflow vs. Others)",
                description: "The Runner executes the Beam pipeline on a specific processing engine. Dataflow is Google Cloud's managed offering.",
                headers: ["Runner", "Execution Engine", "Key Benefit"],
                rows: [
                    { key: "Dataflow Runner", data: ["Google Cloud (Managed Service)", "Fully managed auto-scaling and optimization"] },
                    { key: "Flink Runner", data: ["Apache Flink", "Open source compatibility, self-managed"] },
                    { key: "Spark Runner", data: ["Apache Spark", "Integration with existing Spark ecosystems"] },
                ]
            },
            stateTimers: {
                title: "State and Timers (Advanced Streaming)",
                description: "State allows workers to store data related to a key between events, and Timers allow processing based on time passage.",
                headers: ["Concept", "Use Case", "Benefit in Streaming"],
                rows: [
                    { key: "Keyed State", data: ["Store a running count or latest value for a User ID", "Maintains context across multiple events in the stream"] },
                    { key: "Timers", data: ["Set a timer to check for activity after a 10-minute gap", "Enables sessionization or inactivity detection"] },
                    { key: "Dataflow Shuffle", data: ["Managed, highly efficient shuffling of keyed data", "Optimizes GroupByKey and State operations"] },
                ]
            }
        };

        /**
         * Converts the global state into HTML and updates the DOM.
         */
        const render = () => {
            const container = document.getElementById('table-container');
            const messageBar = document.getElementById('message-bar');
            const tabButtons = document.querySelectorAll('.tab-button');

            // 1. Update Tabs
            tabButtons.forEach(btn => {
                btn.classList.remove('bg-indigo-700', 'text-white');
                btn.classList.add('bg-white', 'text-indigo-700', 'hover:bg-indigo-50');
                if (btn.dataset.tab === state.currentTab) {
                    btn.classList.remove('bg-white', 'text-indigo-700', 'hover:bg-indigo-50');
                    btn.classList.add('bg-indigo-700', 'text-white', 'shadow-lg');
                }
            });

            // 2. Update Message Bar
            messageBar.innerHTML = `<span class="font-bold">${concepts[state.currentTab].title}</span>: ${concepts[state.currentTab].description}`;

            // 3. Generate Table HTML
            const currentConcept = concepts[state.currentTab];
            let html = '<table class="w-full responsive-table shadow-xl rounded-xl overflow-hidden">';

            // Desktop Headers
            html += '<thead class="bg-indigo-800 text-white"><tr>';
            currentConcept.headers.forEach(header => {
                html += `<th class="p-3 text-left font-semibold text-sm">${header}</th>`;
            });
            html += '</tr></thead>';

            // Body
            html += '<tbody>';
            currentConcept.rows.forEach(row => {
                html += '<tr class="md:border-b md:border-gray-20">';
                
                // First cell is the key, styled differently
                let rowKeyClasses = 'font-semibold text-indigo-800 md:bg-indigo-50';
                
                // Specific styling/content overrides for concepts
                if (state.currentTab === 'pcollections') {
                    if (row.key === 'Bounded') rowKeyClasses = 'font-semibold text-indigo-800 md:bg-cyan-100';
                    if (row.key === 'Unbounded') rowKeyClasses = 'font-semibold text-indigo-800 md:bg-green-100';
                }
                if (state.currentTab === 'watermarks') {
                    if (row.key.includes('Event Time')) rowKeyClasses = 'font-semibold text-indigo-800 md:bg-yellow-100';
                    if (row.key.includes('Processing Time')) rowKeyClasses = 'font-semibold text-indigo-800 md:bg-red-100';
                }
                if (state.currentTab === 'windowing') {
                    rowKeyClasses = 'font-semibold text-indigo-800 md:bg-indigo-50';
                }
                if (state.currentTab === 'runners') {
                    rowKeyClasses = 'font-semibold text-indigo-800 md:bg-indigo-50';
                }
                if (state.currentTab === 'stateTimers') {
                    rowKeyClasses = 'font-semibold text-indigo-800 md:bg-indigo-50';
                }
                if (state.currentTab === 'transforms') {
                    rowKeyClasses = 'font-semibold text-indigo-800 md:bg-indigo-50';
                }
                if (state.currentTab === 'triggers') {
                    rowKeyClasses = 'font-semibold text-indigo-800 md:bg-indigo-50';
                }
                if (state.currentTab === 'architecture') {
                    rowKeyClasses = 'font-semibold text-indigo-800 md:bg-indigo-50';
                }

                html += `<td data-label="${currentConcept.headers[0]}" class="${rowKeyClasses}">${row.key}</td>`;
                
                // Data cells
                row.data.forEach((cellData, colIndex) => {
                    let cellClasses = 'data-cell';
                    if (state.currentTab === 'pcollections') {
                        if (row.key === 'Bounded' && colIndex === 0) cellClasses = 'bounded-cell';
                        if (row.key === 'Unbounded' && colIndex === 0) cellClasses = 'unbounded-cell';
                    }
                    if (state.currentTab === 'watermarks') {
                        if (row.key.includes('Event Time') && colIndex === 0) cellClasses = 'time-event';
                        if (row.key.includes('Processing Time') && colIndex === 0) cellClasses = 'time-processing';
                    }
                    if (state.currentTab === 'windowing') {
                        if (currentConcept.headers[colIndex + 1].includes('Visual')) cellClasses = 'data-cell font-mono text-xs text-left px-2';
                    }

                    html += `<td data-label="${currentConcept.headers[colIndex + 1]}" class="${cellClasses}">${cellData}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        };

        /**
         * Switches the active concept tab.
         * @param {string} tabName
         */
        const switchTab = (tabName) => {
            state.currentTab = tabName;
            render();
        };

        // Initial setup and event listeners
        window.onload = () => {
            // Set up tab listeners
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => switchTab(button.dataset.tab));
            });

            // Start with the 'architecture' tab
            switchTab('architecture');
        };
    </script>
</head>
<body class="p-8">
    <a href="index.html" class="text-gray-600 hover:text-indigo-600 hover:underline font-semibold mb-6 inline-block">&larr; Back to Home</a>
    <h1 class="text-4xl font-extrabold text-gray-800 mb-6 flex items-center">
        <svg class="w-8 h-8 mr-3 text-indigo-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
        Cloud Dataflow (Apache Beam) Pipeline Essentials
    </h1>
    <p class="text-lg text-gray-600 mb-8">Click on the tabs below to explore the core components and concepts that make up the Apache Beam programming model.</p>

    <!-- Tab Navigation -->
    <div class="flex flex-wrap space-x-4 space-y-2 mb-8">
        <button data-tab="architecture" class="tab-button py-2 px-4 rounded-lg font-semibold border border-indigo-700 transition duration-150 ease-in-out">
            1. Beam Architecture (SDK/Runner)
        </button>
        <button data-tab="pcollections" class="tab-button py-2 px-4 rounded-lg font-semibold border border-indigo-700 transition duration-150 ease-in-out">
            2. PCollections (Data Abstraction)
        </button>
        <button data-tab="transforms" class="tab-button py-2 px-4 rounded-lg font-semibold border border-indigo-700 transition duration-150 ease-in-out">
            3. PTransforms (ParDo, GBK)
        </button>
        <button data-tab="windowing" class="tab-button py-2 px-4 rounded-lg font-semibold border border-indigo-700 transition duration-150 ease-in-out">
            4. Windowing (Time-based Slicing)
        </button>
        <button data-tab="watermarks" class="tab-button py-2 px-4 rounded-lg font-semibold border border-indigo-700 transition duration-150 ease-in-out">
            5. Watermarks (Time Tracking)
        </button>
        <button data-tab="triggers" class="tab-button py-2 px-4 rounded-lg font-semibold border border-indigo-700 transition duration-150 ease-in-out">
            6. Triggers (When to Emit)
        </button>
        <button data-tab="stateTimers" class="tab-button py-2 px-4 rounded-lg font-semibold border border-indigo-700 transition duration-150 ease-in-out">
            7. State & Timers (Context)
        </button>
        <button data-tab="runners" class="tab-button py-2 px-4 rounded-lg font-semibold border border-indigo-700 transition duration-150 ease-in-out">
            8. Execution Runners (Dataflow)
        </button>
    </div>

    <!-- Explanation Bar -->
    <div id="message-bar" class="bg-blue-100 border-l-4 border-blue-500 text-blue-800 p-4 mb-8 rounded-md shadow-md">
        <!-- Message will be populated by JS -->
    </div>

    <!-- Dataflow Visualizer Container -->
    <div id="table-container" class="mt-8">
        <!-- Visual table will be generated here -->
    </div>
</body>
</html>
