<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Deep Dive: Databricks Auto Loader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony (Light Slate background, Dark Gray text, Muted Teal accent) -->
    <!-- Application Structure Plan: A single-page, scrolling interactive guide. Structure includes: 1. Animated Core Architecture Diagram. 2. Interactive side-by-side comparison of Directory Listing vs. File Notification modes with animated data flows. 3. A dynamic bar chart showing cost/scalability differences based on user input. 4. A clear visual diagram clarifying Pub/Sub's dual roles. This structure was chosen to transform a static technical document into an engaging, hands-on learning tool that clarifies complex processes through visualization and interaction, making the concepts easier to grasp and remember. -->
    <!-- Visualization & Content Choices: 1. Core Architecture: Goal=Inform -> HTML/CSS Diagram -> Non-interactive -> Replaces static table for better visual flow. 2. Ingestion Modes: Goal=Compare/Organize -> JS-animated HTML diagrams -> User triggers animation -> Clearly visualizes process steps side-by-side. 3. Efficiency Comparison: Goal=Compare -> Interactive Bar Chart (Chart.js) -> User controls data volume via slider/buttons -> Makes the abstract concept of scalability tangible and impactful. 4. Pub/Sub Roles: Goal=Inform/Organize -> Static HTML/CSS Diagram -> Non-interactive -> Directly contrasts the two distinct use cases to resolve common confusion. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .diagram-box {
            border: 2px solid #e2e8f0;
            background-color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        .diagram-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #94a3b8;
        }
        .flow-item {
            transition: background-color 0.5s ease-in-out, border-color 0.5s ease-in-out, transform 0.3s ease;
        }
        .active-flow {
            background-color: #ccfbf1;
            border-color: #14b8a6;
            transform: scale(1.05);
        }
        .data-packet {
            position: absolute;
            top: 50%;
            left: -20px;
            width: 20px;
            height: 20px;
            background-color: #2dd4bf;
            border-radius: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: all 0.8s ease-in-out;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
    </style>
</head>
<body class="text-slate-700">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-teal-500 rounded-lg flex items-center justify-center text-white font-bold text-xl">A</div>
                    <h1 class="text-2xl font-bold text-slate-800">Auto Loader Deep Dive</h1>
                </div>
                <div class="hidden md:flex items-center space-x-6 text-sm font-medium text-slate-600">
                    <a href="index.html" class="text-slate-600 hover:text-teal-600 transition-colors">Home</a>
                    <a href="#architecture" class="hover:text-teal-600 transition-colors">Architecture</a>
                    <a href="#modes" class="hover:text-teal-600 transition-colors">Ingestion Modes</a>
                    <a href="#efficiency" class="hover:text-teal-600 transition-colors">Efficiency</a>
                    <a href="#pubsub" class="hover:text-teal-600 transition-colors">Pub/Sub Roles</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">

        <section id="intro" class="text-center mb-20">
            <h2 class="text-4xl md:text-5xl font-bold tracking-tight text-slate-900">Understand Data Ingestion Like Never Before.</h2>
            <p class="mt-6 max-w-3xl mx-auto text-lg text-slate-600">This interactive guide explores Databricks Auto Loader, a powerful tool for ingesting data files from cloud storage. We'll visualize its core architecture, compare its two primary file discovery modes, and clarify its relationship with services like Google Cloud Pub/Sub.</p>
        </section>

        <section id="architecture" class="mb-24 scroll-mt-24">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-slate-900">The Core Architecture</h3>
                <p class="mt-4 max-w-2xl mx-auto text-md text-slate-600">Every Auto Loader process, regardless of its discovery mode, follows this fundamental, fault-tolerant architecture to ensure every file is processed exactly once.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-7 items-center gap-4">
                <div class="diagram-box col-span-1 md:col-span-1">
                    <span class="text-4xl">‚òÅÔ∏è</span>
                    <h4 class="font-semibold mt-2">Source (GCS)</h4>
                    <p class="text-xs text-slate-500">New files arrive</p>
                </div>
                <div class="diagram-arrow md:col-span-1 transform md:rotate-0 rotate-90">‚Üí</div>
                <div class="diagram-box col-span-1 md:col-span-1">
                     <span class="text-4xl">üì¶</span>
                    <h4 class="font-semibold mt-2">cloudFiles Source</h4>
                    <p class="text-xs text-slate-500">Tracks & reads data</p>
                </div>
                <div class="diagram-arrow md:col-span-1 transform md:rotate-0 rotate-90">‚Üí</div>
                <div class="diagram-box col-span-1 md:col-span-1 relative">
                     <span class="text-4xl">üóÉÔ∏è</span>
                    <h4 class="font-semibold mt-2">Checkpoint</h4>
                    <p class="text-xs text-slate-500">Stores file state</p>
                </div>
                <div class="diagram-arrow md:col-span-1 transform md:rotate-0 rotate-90">‚Üí</div>
                <div class="diagram-box col-span-1 md:col-span-1">
                     <span class="text-4xl">üíæ</span>
                    <h4 class="font-semibold mt-2">Sink (Delta Lake)</h4>
                    <p class="text-xs text-slate-500">Stores processed data</p>
                </div>
            </div>
        </section>

        <section id="modes" class="mb-24 scroll-mt-24">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-slate-900">Interactive: File Discovery Modes</h3>
                <p class="mt-4 max-w-2xl mx-auto text-md text-slate-600">Auto Loader finds new files in two distinct ways. Click "Animate Flow" on each mode to see how they work and understand their fundamental differences in efficiency.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                
                <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                    <h4 class="text-2xl font-bold text-slate-800">Mode A: Directory Listing</h4>
                    <p class="text-sm text-slate-500 mt-2 mb-6">Simple to set up, but less efficient at scale as it must repeatedly list all files and directories.</p>
                    <div id="dir-listing-flow" class="space-y-4 relative">
                        <div class="data-packet"></div>
                        <div class="flow-item diagram-box" data-step="1"><strong>1. Scan:</strong> Periodically list GCS directory</div>
                        <div class="flow-item diagram-box" data-step="2"><strong>2. Compare:</strong> Check against known files in Checkpoint</div>
                        <div class="flow-item diagram-box" data-step="3"><strong>3. Ingest:</strong> Read only new files into Spark</div>
                    </div>
                    <button id="animate-dir-listing" class="w-full mt-6 bg-teal-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-600 transition-colors">Animate Flow</button>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                    <h4 class="text-2xl font-bold text-slate-800">Mode B: File Notification</h4>
                    <p class="text-sm text-slate-500 mt-2 mb-6">Highly performant and scalable. It uses cloud event services to get notified instantly when a file arrives.</p>
                    <div id="file-notification-flow" class="space-y-4 relative">
                        <div class="data-packet"></div>
                        <div class="flow-item diagram-box" data-step="1"><strong>1. Event:</strong> New file in GCS triggers notification</div>
                        <div class="flow-item diagram-box" data-step="2"><strong>2. Discovery:</strong> Pub/Sub sends file path to Auto Loader</div>
                        <div class="flow-item diagram-box" data-step="3"><strong>3. Ingest:</strong> Read specific file from GCS path</div>
                    </div>
                    <button id="animate-file-notification" class="w-full mt-6 bg-teal-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-600 transition-colors">Animate Flow</button>
                </div>
            </div>
        </section>

        <section id="efficiency" class="mb-24 scroll-mt-24">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-slate-900">Visualizing Efficiency at Scale</h3>
                <p class="mt-4 max-w-2xl mx-auto text-md text-slate-600">The true difference between the modes becomes clear as the number of files increases. Use the buttons below to simulate different data volumes and see how the discovery cost is affected.</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                <div class="chart-container">
                    <canvas id="efficiencyChart"></canvas>
                </div>
                <div class="flex justify-center flex-wrap gap-3 mt-6">
                    <button data-files="1000" class="efficiency-btn bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">1,000 Files</button>
                    <button data-files="100000" class="efficiency-btn bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">100,000 Files</button>
                    <button data-files="1000000" class="efficiency-btn bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors active-btn">1 Million Files</button>
                    <button data-files="10000000" class="efficiency-btn bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">10 Million Files</button>
                </div>
            </div>
        </section>

        <section id="pubsub" class="scroll-mt-24">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-slate-900">Clarified: Pub/Sub's Two Roles</h3>
                <p class="mt-4 max-w-2xl mx-auto text-md text-slate-600">A common point of confusion is how Auto Loader uses Pub/Sub versus how Databricks ingests from it directly. They are two distinct patterns for different use cases.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200 text-center">
                    <h4 class="text-xl font-bold text-slate-800">Auto Loader: Pub/Sub for File Events</h4>
                    <p class="text-sm text-slate-500 mt-2 mb-6">Pub/Sub acts as a **notification service**. It tells Auto Loader *that* a file has arrived and *where* it is. The data itself is still in the file on GCS.</p>
                    <div class="space-y-3">
                        <div class="diagram-box"><span class="text-3xl">üìÑ</span><p>File in GCS</p></div>
                        <div class="text-2xl text-slate-400">‚¨áÔ∏è</div>
                        <div class="diagram-box"><span class="text-3xl">üîî</span><p>Pub/Sub Notification</p></div>
                        <div class="text-2xl text-slate-400">‚¨áÔ∏è</div>
                        <div class="diagram-box"><span class="text-3xl">üì¶</span><p>Auto Loader Reads File from GCS</p></div>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200 text-center">
                    <h4 class="text-xl font-bold text-slate-800">Native Connector: Pub/Sub for Message Streams</h4>
                    <p class="text-sm text-slate-500 mt-2 mb-6">Pub/Sub acts as a **data source**. The Databricks stream reads the message content *directly* from the Pub/Sub topic itself.</p>
                     <div class="space-y-3">
                        <div class="diagram-box"><span class="text-3xl">üí¨</span><p>Message Stream</p></div>
                        <div class="text-2xl text-slate-400">‚¨áÔ∏è</div>
                        <div class="diagram-box"><span class="text-3xl">üì¨</span><p>Pub/Sub Topic</p></div>
                        <div class="text-2xl text-slate-400">‚¨áÔ∏è</div>
                        <div class="diagram-box"><span class="text-3xl">üíª</span><p>Databricks Reads Message</p></div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white mt-16 border-t">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500">
            <p>&copy; 2025 Interactive Guides. An illustrative web application.</p>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            function animateFlow(flowElementId) {
                const flowContainer = document.getElementById(flowElementId);
                if (!flowContainer) return;

                const items = flowContainer.querySelectorAll('.flow-item');
                const packet = flowContainer.querySelector('.data-packet');
                let currentStep = 0;
                
                items.forEach(item => item.classList.remove('active-flow'));
                packet.style.transition = 'none';
                packet.style.opacity = '0';
                packet.style.top = '-20px';


                function nextStep() {
                    if (currentStep > 0) {
                        items[currentStep - 1].classList.remove('active-flow');
                    }
                    if (currentStep < items.length) {
                        const currentItem = items[currentStep];
                        currentItem.classList.add('active-flow');
                        
                        packet.style.transition = 'top 0.8s ease-in-out, opacity 0.4s ease-in-out';
                        packet.style.opacity = '1';
                        packet.style.top = `${currentItem.offsetTop + currentItem.offsetHeight / 2}px`;

                        currentStep++;
                        setTimeout(nextStep, 1500);
                    } else {
                        packet.style.opacity = '0';
                         setTimeout(() => {
                            items.forEach(item => item.classList.remove('active-flow'));
                         }, 500);
                    }
                }
                
                setTimeout(nextStep, 100);
            }

            document.getElementById('animate-dir-listing').addEventListener('click', () => {
                animateFlow('dir-listing-flow');
            });

            document.getElementById('animate-file-notification').addEventListener('click', () => {
                animateFlow('file-notification-flow');
            });


            const ctx = document.getElementById('efficiencyChart').getContext('2d');
            const efficiencyData = {
                '1000': { dir: 10, notify: 5 },
                '100000': { dir: 100, notify: 8 },
                '1000000': { dir: 500, notify: 12 },
                '10000000': { dir: 2500, notify: 20 }
            };

            const efficiencyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Directory Listing', 'File Notification'],
                    datasets: [{
                        label: 'Relative Discovery Cost',
                        data: [500, 12],
                        backgroundColor: [
                            'rgba(244, 63, 94, 0.6)',
                            'rgba(20, 184, 166, 0.6)'
                        ],
                        borderColor: [
                            'rgba(244, 63, 94, 1)',
                            'rgba(20, 184, 166, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Relative Cost Unit'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Discovery Cost Comparison (Lower is Better)',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                           callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            
            const efficiencyBtns = document.querySelectorAll('.efficiency-btn');
            
            function updateChart(fileCount) {
                const data = efficiencyData[fileCount];
                efficiencyChart.data.datasets[0].data = [data.dir, data.notify];
                efficiencyChart.options.plugins.title.text = `Discovery Cost for ${parseInt(fileCount).toLocaleString()} Files`;
                efficiencyChart.update();

                efficiencyBtns.forEach(btn => {
                    btn.classList.remove('bg-teal-500', 'text-white');
                    btn.classList.add('bg-slate-200', 'text-slate-700');
                    if (btn.dataset.files === fileCount) {
                        btn.classList.add('bg-teal-500', 'text-white');
                        btn.classList.remove('bg-slate-200', 'text-slate-700');
                    }
                });
            }

            efficiencyBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    updateChart(e.target.dataset.files);
                });
            });

            updateChart('1000000');
        });
    </script>
</body>
</html>
